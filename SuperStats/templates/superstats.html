{% extends 'home.html' %}

{% load static %}

{% block title %}Estadísticas{% endblock %}

{% block body2 %}

<script src="{% static 'js/editablegrid.js' %}"></script>
<script src="{% static 'js/editablegrid_renderers.js' %}"></script>
<script src="{% static 'js/editablegrid_editors.js' %}"></script>
<script src="{% static 'js/editablegrid_validators.js' %}"></script>
<script src="{% static 'js/editablegrid_utils.js' %}"></script>
<script src="{% static 'js/editablegrid_charts.js' %}"></script>

<link rel="stylesheet" type="text/css" href="{% static 'css/editablegrid.css'%}">
<script type="text/javascript" src="{% static 'js/jquery.nicescroll.min.js' %}"></script>

<style>
table.testclass { border-collapse: collapse; border: 1px solid #CCB; width:250px;}
table.testclass td, table.testclass th { padding: 5px; border: 1px solid #E0E0E0;}
table.testclass th { background: #E5E5E5; text-align: left;}
table.testclass th {
    color: #555;
    background-color: #ccc;
    border: 1px solid #bbb;
    text-shadow: 0 1px 0 #eee;
    vertical-align: bottom;
    padding: 5px;
    text-align:center;
}
table.testclass td {
  text-align: left;
}

table.testinst { border-collapse: collapse; border: 1px solid #CCB; width:350px;}
table.testinst td, table.testinst th { padding: 5px; border: 1px solid #E0E0E0;}
table.testinst th { background: #E5E5E5; text-align: left;}
table.testinst th {
    color: #555;
    background-color: #ccc;
    border: 1px solid #bbb;
    text-shadow: 0 1px 0 #eee;
    vertical-align: bottom;
    padding: 5px;
    text-align:center;
}
table.testinst td {
  text-align: left;
}

.ribbon {
  position: relative;
  left: 0px; top: -53px;
  z-index: 1;
  overflow: hidden;
  width: 63px; height: 54px;
  text-align: right;
}
.ribbon span {
  font-size: 9px;
  font-weight: bold;
  color: #FFF;
  text-transform: uppercase;
  text-align: center;
  line-height: 15px;
  transform: rotate(-45deg);
  -webkit-transform: rotate(-45deg);
  width: 97px;
  display: block;
  background: #79A70A;
  background: linear-gradient(#9BC90D 0%, #79A70A 100%);
  box-shadow: 0 3px 10px -5px rgba(0, 0, 0, 1);
  position: absolute;
  top: 13px; left: -25px;
}
.ribbon span::before {
  content: "";
  position: absolute; left: 0px; top: 100%;
  z-index: -1;
  /*border-left: 3px solid #79A70A;
  border-right: 3px solid transparent;
  border-bottom: 3px solid transparent;
  border-top: 3px solid #79A70A;*/
}
.ribbon span::after {
  content: "";
  position: absolute; right: 0px; top: 100%;
  z-index: -1;
  /*border-left: 3px solid transparent;
  border-right: 3px solid #79A70A;
  border-bottom: 3px solid transparent;
  border-top: 3px solid #79A70A;*/
}
#newSchedule{
	border: 1px solid #C6D1AD;
    border-radius: 5px;
    display:none; 
    height:220px; 
    padding:15px;
    padding-left: 33%;
    padding-right: 33%;
    text-align: center;
}
label{
	width: 135px;
}

tr.nocolor:hover {
  background-color: transparent;
}

 
#sidebar {
  margin-right: -1px;
  float: left;
  width: 240px;

    box-sizing: border-box;
   -moz-box-sizing: border-box;
   z-index: 2;
   margin-right: -1px;
}
#sidebar ul {
    margin: 0;
    padding: 0;
    list-style: none;
}
#sidebar ul li {
    margin: 0;
}
#sidebar ul li a {
  margin: 1px 0px 1px 1px;
    padding: 15px 20px;
    font-size: 16px;
    font-weight: 100;
    background: #EEEEEE;
    text-decoration: none;
    display: block;
    border-radius: 10px 1px 1px 10px;
    border: 1px solid #ddd;
    -webkit-transition:  background 0.3s ease-in-out;
    -moz-transition:  background 0.3s ease-in-out;
    -ms-transition:  background 0.3s ease-in-out;
    -o-transition:  background 0.3s ease-in-out;
    transition:  background 0.3s ease-in-out;
    
}
#sidebar ul li a.select{
  border-right: 1px solid #f7f7f7;
  background: #f7f7f7;
  color: #56861f;
  
}
#sidebar ul li:hover a {
    background: #f7f7f7;
    color: #56861f;
}
#sidebar ul li:visited a {
    background: #f7f7f7;
    color: #56861f;
}
input[type="checkbox"].institution{
  z-index: 1000;
  width: 80%;
  height: 80%;
  margin-bottom:10px;
}

input[type="checkbox"].all_inst{
  z-index: 1000;
  width: 80%;
  height: 80%;
  margin-bottom:10px;
}

input[type="checkbox"]#checkschedule{
  width: 100%;
  height: 100%;
}

td{
  margin: auto;
}
table.testsched { border-collapse: collapse; border: 1px solid #CCB; width:650px;}
table.testsched td, table.testsched th { padding: 5px; border: 1px solid #E0E0E0;}
table.testsched th { background: #E5E5E5; text-align: left;}
table.testsched th {
    color: #555;
    background-color: #ccc;
    border: 1px solid #bbb;
    text-shadow: 0 1px 0 #eee;
    vertical-align: bottom;
    padding: 5px;
    text-align:center;
}
table.testsched td {
  text-align: left;
}

.whiteLetter{
    color: white;  
}

.container{
  max-width: 700px;
    /*position: relative;*/
    /*height: 100%;*/
    /*width: 100%;*/
}
.main-content {
  padding: 15px 20px;
  background: #f7f7f7;
  width: 100%;
  padding-left:10%;
  padding-right:10%;
  border: 1px solid #ddd;
  z-index: 1;
}
.allcontent{
  background: #f7f7f7;
  width:100%;
  position: relative;
}
.contenedor{
  padding: 15px 20px;
  background: #f7f7f7;
  width: 100%;
  padding-left:10%;
  padding-right:10%;
  border: 1px solid #ddd;
  z-index: 1;
}

</style>


<br>
<div class="allcontent">
  <br>
  <h1 style="text-align:center;">Estadísticas</h1>
<div class="container" style="float:left;width:50%;">
<div class="main-content">

  <div id="instituciones" style="width:100%;float:left;">
  <h2 align="center">Establecimientos</h2>
  <table class="testinst">
  <tr>
    <th>Todos los establecimientos</th>
    <th style="align-content:center;"><input type="checkbox" id="check_all_none_inst" class="all_inst"></th>
  </tr>
  {% for institution in institutions %}
  <tr>
    <td>{{institution.name}}</td>
    <td><input type="checkbox" value="{{ institution.id_institution }}" name="institution" class="institution" onclick="updateClass();"></td>
  </tr>
  {% endfor %}
  </table>
</div>
  <!--<div id="cursos" style="width:100%;float:left;">
  <h2 align="center">Cursos</h2>

  <div id="cursoclass" style="overflow-y: auto;outline: none; height:500px"></div>
  </div>!-->

  <div id="trabajo" style="width:100%;float:left;">
    <br>
  <h2 align="center">Tipo de Trabajo</h2>
  <div id="testsched">

  </div>
  <br>
  <div align="left" style="margin-left:200px">
  <input type="radio" name="seleccion" onclick="selectSchedule(this)" value="radio1">Todo <br>
  <input type="radio" name="seleccion" onclick="selectSchedule(this)" value="radio2">Horario de clases <br>
  <input type="radio" name="seleccion" onclick="selectSchedule(this)" value="radio3">Fuera horario de clases <br>
  <input type="radio" name="seleccion" onclick="selectSchedule(this)" value="radio4">Personalizado <br>  
  </div>
  </div>
  <div id="fechas" style="width:100%;float:left;">
    <br>
    <h2 align="left" style="margin-left:200px;">Fechas</h2>
        <div  class="fechas">
          <p class="label_input"><strong id="fIniTooltip">Desde</strong></p>
          <input name="desde" onchange="validar()" onkeyup="validar()" id="desde" class="ui-corner-all placeholder simple-input search-input blur-on-esc skill_search" type="date" max="9999-12-31" placeholder="Desde"/>
        </div>
        <div  class="fechas">
          <p class="label_input"><strong id="fTerTooltip">Hasta</strong></p>
          <input name="hasta" onchange="validar()" onkeyup="validar()" id="hasta" class="ui-corner-all placeholder simple-input search-input blur-on-esc skill_search" type="date" max="9999-12-31" placeholder="Hasta"/>
        </div>
  </div>




</div>

</div>

  <div class="contenedor" style="width:28%;float:left;">
  <br>
<h2 align="center">Cursos</h2>
<div id="contenedor">
  <!--<ul>
    <li data-jstree='{"opened":true}'>Root node
      <ul>
        <li>Child node 1</li>
        <li>Child node 2</li>
      </ul>
    </li>
  </ul>!-->
  </div>
</div>
  <div style="float:left;width:100%" align="center">
    <input type="button" id="button_realizar" onClick="crearEstadisticas();" class="kui-button kui-button-plain kui-button-primary" value="Ver estadísticas">
  </div>
</div>
<div class="graphics" id="graph" align="center">
<input type="button" id="button_parameter" onClick="containerShow()" class="kui-button kui-button-plain kui-button-primary" value="Definir parámetros">
<hr>
<div id="containerej" style="min-width: 300px; height: 500px; margin: 0 auto"></div>
<hr>
<div id="containervid" style="min-width: 300px; height: 500px; margin: 0 auto"></div>
<hr>
<div id="containertot" style="min-width: 300px; height: 500px; margin: 0 auto"></div>
</div>

<div id="popup" style="display:none">
	<div id="close">X</div>
</div>

<div id="popup_error" class="popup" style="display:none">
  <div id="close" onClick="$('#popup_error').fadeOut();$('#hover').fadeOut();">X</div>
</div>

<script>

    $(document).ready(function(){
        $('table#sort_table').tablesorter({
            animation: 'slide',
            speed: 1200,
            sortList: [[0,0], [0,1]]
        });

    });
    //$('#contenedor').jstree('core':{'data':{"id": 0, "parent":"#", "text":'Todos los Cursos', "state":{"opened":"true"}, "icon":"false"}} );
    /*$('#contenedor').jstree({
                    'core': {
                        'check_callback' : true,
                        'data': {"id": 0, "parent":"#", "text":'Todos los Cursos', "state":{"opened":"true"}, "icon":"false"}
                    },
                    "checkbox": {
                        'visible': true,
                        'keep_selected_style': false
                    },
                    "plugins": ["wholerow", "checkbox"]
                });*/
    drawNiceScrolls();
    $('.graphics').hide();
    $('#testsched').hide();
      $("#hover").click(function(){
          $(this).fadeOut();
          $("#popup").fadeOut();
          $("#popup_error").fadeOut();
        });


$('#estadisticas').addClass('active selected');

$('input[name="day"]').prop("disabled", true);



$('#check_all_none_inst').click(function () {
    if ( $(this).is(':checked') ){
        $('.institution').prop("checked", true);
        updateClass();
    }
    else{
        $('.institution').removeAttr("checked");
        updateClass();
    }

});

function drawNiceScrolls(){
  $("#cursoclass").niceScroll({ cursorwidth:'10px', autohidemode: false, cursorcolor:'#D9D9D9', zindex:10, railoffset: { left: 12} });
}

function drawTableSchedule(){
  var tableSchedule='<table class="testsched" id="sort_table">';
  tableSchedule+="<thead><tr><th width='30%'>Horario</th><th width='10%' id='HSE' onclick='diaselect(\x22Monday\x22);'>Lunes</th>";
  tableSchedule+="<th width='10%' id='HSE' onclick='diaselect(\x22Tuesday\x22);'>Martes</th>";
  tableSchedule+="<th width='10%' id='HSE' onclick='diaselect(\x22Wednesday\x22);'>Miércoles</th>";
  tableSchedule+="<th width='10%' id='HSE' onclick='diaselect(\x22Thursday\x22);'>Jueves</th>";
  tableSchedule+="<th width='10%' id='HSE' onclick='diaselect(\x22Friday\x22);'>Viernes</th>";
  tableSchedule+="<th width='10%' id='HSE' onclick='diaselect(\x22Saturday\x22);'>Sábado</th>";
  tableSchedule+="<th width='10%' id='HSE' onclick='diaselect(\x22Sunday\x22);'>Domingo</th>";
  tableSchedule+="</tr></thead>"
  for(var i=0;i<24;i++){
    tableSchedule+="<tr id='"+i+"' class='nocolor'>";
    if(i<10){
      tableSchedule+="<th id='HSE' onclick='funciondos(0"+i+")'>0"+parseInt(0+i)+":00 - 0"+parseInt(0+i)+":59</th>"
      tableSchedule+="<td><input type='checkbox' value='0"+i+"_Monday' name='day"+i+"' id='checkschedule'></td>";
      tableSchedule+="<td><input type='checkbox' value='0"+i+"_Tuesday' name='day"+i+"' id='checkschedule'></td>";
      tableSchedule+="<td><input type='checkbox' value='0"+i+"_Wednesday' name='day"+i+"' id='checkschedule'></td>";
      tableSchedule+="<td><input type='checkbox' value='0"+i+"_Thursday' name='day"+i+"' id='checkschedule'></td>";
      tableSchedule+="<td><input type='checkbox' value='0"+i+"_Friday' name='day"+i+"' id='checkschedule'></td>";
      tableSchedule+="<td><input type='checkbox' value='0"+i+"_Saturday' name='day"+i+"' id='checkschedule'></td>";
      tableSchedule+="<td><input type='checkbox' value='0"+i+"_Sunday' name='day"+i+"' id='checkschedule'></td></tr>";
    }
    else{
      tableSchedule+="<th id='HSE' onclick='funciondos("+i+")'>"+parseInt(0+i)+":00 - "+parseInt(0+i)+":59</th>"
      tableSchedule+="<td><input type='checkbox' value='"+i+"_Monday' name='day"+i+"' id='checkschedule'></td>";
      tableSchedule+="<td><input type='checkbox' value='"+i+"_Tuesday' name='day"+i+"' id='checkschedule'></td>";
      tableSchedule+="<td><input type='checkbox' value='"+i+"_Wednesday' name='day"+i+"' id='checkschedule'></td>";
      tableSchedule+="<td><input type='checkbox' value='"+i+"_Thursday' name='day"+i+"' id='checkschedule'></td>";
      tableSchedule+="<td><input type='checkbox' value='"+i+"_Friday' name='day"+i+"' id='checkschedule'></td>";
      tableSchedule+="<td><input type='checkbox' value='"+i+"_Saturday' name='day"+i+"' id='checkschedule'></td>";
      tableSchedule+="<td><input type='checkbox' value='"+i+"_Sunday' name='day"+i+"' id='checkschedule'></td></tr>";
    }

  }
  tableSchedule+="</table>";
  document.getElementById('testsched').innerHTML = tableSchedule;

  $("th#HSE").mouseover(function(){
  $(this).css("background-color", "gray");
  $(this).css("color", "white");
  });
  $("th#HSE").mouseout(function(){
  $(this).css("background-color", "#ccc");
    $(this).css("color", "#555");
  });
}

function updateClass(){
  var sel = $('input[name="institution"]:checked').map(function(_,el){
    return $(el).val();
  }).get();
  $.ajax({
    url: "{% url 'SuperStats:selectClass' %}",
    type: "POST",
    data: {sel},
      success: function(response){
        jsonResponse = JSON.parse(response);
        //$('#contenedor').jstree(jsonResponse);
        //console.log(jsonResponse);
        drawTableClass(jsonResponse);
        //$('#contenedor').jstree(true).settings.core.data=jsonResponse;
        //$('#contenedor').jstree(true).refresh();
      }
  });
}

function drawTableClass(json){
  //console.log(json);
  //$('#contenedor').jstree(json);
  /*$('#contenedor').jstree({
    core : {
      data : function (node, cb) {cb(json);},
    }
  })*/
  //$('#contenedor').jstree().refresh();
  $('#contenedor').jstree(json);
  //$('#contenedor').jstree(true).settings.core.data=json;
  //$('#contenedor').jstree(true).refresh();
  //var tree = jQuery.jstree._reference("#contenedor");
  //var tree = $('#contenedor').jstree(true);
  //tree.jstree("destroy");
  //tree.deselect_all();
  //tree.refresh();
  //console.log(json);
  //$('#contenedor').jstree(json);
  //tree.refresh();
  //console.log(json);
  //$('#contenedor').empty();
  //$('#contenedor').jstree(json);
  //$('#contenedor').jstree(true).settings.core.data=json;
  //$('#contenedor').jstree(json).refresh();
  //console.log(json)
  /*
  var establecimientos=json["instituciones"];

  var myTable= "<table class='testclass'><tr><th width='80%'>Todos los cursos</th>";
  myTable+= "<th style='align-content:center;' width='20%'><input type='checkbox' id='check_all_none'></th></tr>";
  for (var i=0;i<establecimientos.length;i++){
    var colegio = establecimientos[i]["nombreinst"];
    var id = establecimientos[i]["institucion"];
    myTable+="<tr><td style='width: 100px;'>"+colegio+"</td>";
    myTable+="<td><input type='checkbox' value="+id+" name='curso"+id+"' class='curso' onclick='check_all_none_classes("+id+")' id='idcurso"+id+"'></td></tr>";
    var lencursos = Object.keys(establecimientos[i]["cursos"]).length
    for (var j=0;j<lencursos;j++){
      var idcurso = establecimientos[i]["cursos"][j]["idcurso"][j]
      var nombrecurso = establecimientos[i]["cursos"][j]["nombrecurso"][j]
      myTable+="<tr><td style='font-size:75%'>"+nombrecurso+"</td>";
      myTable+="<td><input type='checkbox' value="+idcurso+" name='curso"+idcurso+"' class='curso"+id+"'></td></tr>";
    }
  }
 myTable+="</table>";

 document.getElementById('cursoclass').innerHTML = myTable;
 $('#check_all_none').click(function () {
    if ( $(this).is(':checked') ){
        $('*[class^="curso"]').prop("checked", true);
        //updateSchedule();
    }
    else{
        $('*[class^="curso"]').removeAttr("checked");
        //updateSchedule();
    }

  });
*/
}

function check_all_none_classes(id){
  var idc = $('#idcurso'+id).val();
  console.log(idc)
  if ($('#idcurso'+id).is(':checked')){
    $('.curso'+idc).prop("checked", true);
  }
  else{
    $('.curso'+idc).removeAttr("checked");
  }
}


function containerShow(){
  $(".container").fadeIn();
  $('.graphics').fadeOut();
  drawNiceScrolls();
}

function crearEstadisticas(){
  //aqui va algo
  validar();
  var selhorario=[];
  var selinst = $('input[name="institution"]:checked').map(function(_,el){
    return $(el).val();
  }).get();
  var selcurso = $('input[name*="curso"]:checked').map(function(_,el){
    return $(el).val();
  }).get();
  var radioselect = $('input[value*="radio"]:checked').val();
  if (radioselect=="radio4"){
    selhorario = $('input[name*="day"]:checked').map(function(_,el){
      return $(el).val();
    }).get();
  }
  if (validar() && selinst.length>0 && selcurso.length>0 && radioselect){
    desde = document.getElementById("desde").value;
    hasta = document.getElementById("hasta").value;
    $('.container').fadeOut();
    $('.graphics').fadeIn();
    $.ajax({
      url: "{% url 'SuperStats:selectSuperStats' %}",
      type: "POST",
      data: {selinst, selcurso, desde, hasta, radioselect, selhorario},
        success: function(response){
          jsonResponse = JSON.parse(response);
          //console.log(response);
          graficar(jsonResponse, selinst);
        }
    });
  }
  else{
    $('#popup_error').empty();
    $('#popup_error').append("<p>Faltan datos por seleccionar, revise los campos.</p>")
    $('#popup_error').fadeIn().css('display', '');
    $("#hover").fadeIn().css('display', '');
  }
}

function graficar(json, clase){
  $("#cursoclass").getNiceScroll().remove();
  console.log(json);
  var arrayte=[];
  var arraytv=[];
  var arraycant=[];
  if(json["clases"]){
    var clase = json["clases"]
    for (var i=0;i<clase.length;i++){
      var curso=clase[i]["nombre"];
      var ee=clase[i]["establecimiento"]
      var tpo_ejercicios = clase[i]["tiempo_ejercicios_clase"]
      var tpo_videos = clase[i]["tiempo_videos_clase"]
      var cantidad = clase[i]["total_ejercicios_clase"]
      var nombre = curso +" - "+ee
      arrayte[i]=[nombre, tpo_ejercicios]
      arraytv[i]=[nombre, tpo_videos]
      arraycant[i]=[nombre, cantidad]
    }
  }
  else{
    if(json["students"]){
      var student = json["students"]
      for (var j=0;j<student.length;j++){
        var name=student[j]["name"]
        var tpo_ejercicios = student[j]["tiempo_ejercicios"]
        var tpo_videos = student[j]["tiempo_videos"]
        var cantidad = student[j]["total_ejercicios"]
        arrayte[j]=[name, tpo_ejercicios]
        arraytv[j]=[name, tpo_videos]
        arraycant[j]=[name, cantidad]
      }
    }
  }
  //console.log(arraycant)
  $(function () {
    $('#containerej').highcharts({
        chart: {
            type: 'column'
        },
        title: {
            text: 'Tiempo de ejercicios'
        },
        subtitle: {
            text: 'Source: <a href="https://es.khanacademy.org/">Khan Academy</a>'
        },
        xAxis: {
            type: 'category',
            labels: {
                rotation: -45,
                style: {
                    fontSize: '11px',
                    fontFamily: 'Verdana, sans-serif'
                }
            }
        },
        yAxis: {
            min: 0,
            title: {
                text: 'Tiempo (segundos)'
            }
        },
        legend: {
            enabled: false
        },
        tooltip: {
            pointFormat: 'Tiempo de ejercicios: <b>{point.y} segundos</b>'
        },
        series: [{
            name: 'Tiempo',
            data: arrayte,
            dataLabels: {
                enabled: true,
                rotation: -90,
                color: '#FFFFFF',
                align: 'right',
                format: '{point.y}', // one decimal
                y: 10, // 10 pixels down from the top
                style: {
                    fontSize: '11px',
                    fontFamily: 'Verdana, sans-serif'
                }
            }
        }]
    });
  });

  $(function () {
    $('#containervid').highcharts({
        chart: {
            type: 'column'
        },
        title: {
            text: 'Tiempo de videos'
        },
        subtitle: {
            text: 'Source: <a href="https://es.khanacademy.org/">Khan Academy</a>'
        },
        xAxis: {
            type: 'category',
            labels: {
                rotation: -45,
                style: {
                    fontSize: '11px',
                    fontFamily: 'Verdana, sans-serif'
                }
            }
        },
        yAxis: {
            min: 0,
            title: {
                text: 'Tiempo (segundos)'
            }
        },
        legend: {
            enabled: false
        },
        tooltip: {
            pointFormat: 'Tiempo de videos: <b>{point.y} segundos</b>'
        },
        series: [{
            name: 'Tiempo',
            data: arraytv,
            dataLabels: {
                enabled: true,
                rotation: -90,
                color: '#FFFFFF',
                align: 'right',
                format: '{point.y}', // one decimal
                y: 10, // 10 pixels down from the top
                style: {
                    fontSize: '11px',
                    fontFamily: 'Verdana, sans-serif'
                }
            }
        }]
    });
  });

  $(function () {
    $('#containertot').highcharts({
        chart: {
            type: 'column'
        },
        title: {
            text: 'Cantidad de ejercicios'
        },
        subtitle: {
            text: 'Source: <a href="https://es.khanacademy.org/">Khan Academy</a>'
        },
        xAxis: {
            type: 'category',
            labels: {
                rotation: -45,
                style: {
                    fontSize: '11px',
                    fontFamily: 'Verdana, sans-serif'
                }
            }
        },
        yAxis: {
            min: 0,
            title: {
                text: 'Cantidad (ejercicios)'
            }
        },
        legend: {
            enabled: false
        },
        tooltip: {
            pointFormat: 'Cantidad de ejercicios: <b>{point.y} ejercicios</b>'
        },
        series: [{
            name: 'Cantidad',
            data: arraycant,
            dataLabels: {
                enabled: true,
                rotation: -90,
                color: '#FFFFFF',
                align: 'right',
                format: '{point.y}', // one decimal
                y: 10, // 10 pixels down from the top
                style: {
                    fontSize: '11px',
                    fontFamily: 'Verdana, sans-serif'
                }
            }
        }]
    });
  });
}

function validar(){
  flag = true;
  desde = document.getElementById("desde").value;
  hasta = document.getElementById("hasta").value;
  if(desde == null || desde.length == 0 || /^\s+$/.test(desde)) {
    $('#desde').css('color', '#C30202');
    flag = false;
  }else{
    $('#desde').css('color', '#000000');
  }
  //if(date_end == null || startDate > endDate || endDate < todayDate || date_end.length == 0 || /^\s+$/.test(date_end)) {
  if(hasta == null || desde > hasta || hasta.length == 0 || /^\s+$/.test(hasta)) {
    $('#hasta').css('color', '#C30202');
    flag = false;
  }else{
    $('#hasta').css('color', '#000000');
  }
  return flag
}

function updateSchedule(){
  var sel = $('input[name="clase"]:checked').map(function(_,el){
    return $(el).val();
  }).get();
  //var valor = $('input[value*="radio"]:checked').val()
  
  if ($("input[value*='radio']:checked").val()=="radio2"){
    $('#testsched').hide();
    $('input[name="day"]').prop("checked", false);
    {% for csh in class_schedule %}
      var dia = "{{ csh.day }}"
      var id_sched = "{{ csh.id_schedule_id }}"
      var id_class = "{{ csh.id_class_id }}"
      var idcheckbox = dia+"_"+id_sched;
      for (var i = sel.length - 1; i >= 0; i--) {
        if(sel[i]==id_class){
          $("input[value='"+idcheckbox+"']").prop("checked", true);
        }      
      }
      //console.log(idcheckbox);
    {% endfor %}    
  }
  else{
    if ($("input[value*='radio']:checked").val()=="radio3"){
      $('#testsched').hide();
      $('input[name="day"]').prop("checked", true);
      {% for csh in class_schedule %}
        var dia = "{{ csh.day }}"
        var id_sched = "{{ csh.id_schedule_id }}"
        var id_class = "{{ csh.id_class_id }}"
        var idcheckbox = dia+"_"+id_sched;
        for (var i = sel.length - 1; i >= 0; i--) {
          if(sel[i]==id_class){
            $("input[value='"+idcheckbox+"']").prop("checked", false);
          }      
        }
        //console.log(idcheckbox);
      {% endfor %}    
    }
  }
}

function selectSchedule(radiobutton){
  $('input[name="day"]').prop("checked", false);
  var valor = radiobutton.value;
  if (valor=="radio1"){
    $('#testsched').hide();
    $('input[name="day"]').prop("disabled", true);
    $('input[name="day"]').prop("checked", true);
  }
  if (valor=="radio2"){
    $('#testsched').hide();
    $('input[name="day"]').prop("disabled", true);
    $('#popup').empty();
    var sel = $('input[name*="curso"]:checked').map(function(_,el){
      return $(el).val();
    }).get();
    if (sel.length===0){
      $('#popup').empty();
      $('#popup').append("<p>No existe ningún curso seleccionado</p>")
      $('#popup').fadeIn().css('display', '');
      $("#hover").fadeIn().css('display', '');
    }
    else{
      //console.log(sel);
      {% for csh in class_schedule %}
        var dia = "{{ csh.day }}"
        var id_sched = "{{ csh.id_schedule_id }}"
        var id_class = "{{ csh.id_class_id }}"
        var idcheckbox = dia+"_"+id_sched;
        for (var i = sel.length - 1; i >= 0; i--) {
          if(sel[i]==id_class){
            $("input[value='"+idcheckbox+"']").prop("checked", true);
          }      
        }
        //console.log(idcheckbox);
      {% endfor %}
    }
    
  }
  if (valor=="radio3"){
    $('#testsched').hide();
    $('input[name="day"]').prop("disabled", true);
    $('#popup').empty();
    var sel = $('input[name*="curso"]:checked').map(function(_,el){
      return $(el).val();
    }).get();
    if (sel.length===0){
      $('#popup').empty();
      $('#popup').append("<p>No existe ningún curso seleccionado</p>")
      $('#popup').fadeIn().css('display', '');
      $("#hover").fadeIn().css('display', '');

    }
    else{
      $('input[name="day"]').prop("checked", true);
      //console.log(sel);
      {% for csh in class_schedule %}
        var dia = "{{ csh.day }}"
        var id_sched = "{{ csh.id_schedule_id }}"
        var id_class = "{{ csh.id_class_id }}"
        var idcheckbox = dia+"_"+id_sched;
        for (var i = sel.length - 1; i >= 0; i--) {
          if(sel[i]==id_class){
            $("input[value='"+idcheckbox+"']").prop("checked", false);
          }      
        }
        //console.log(idcheckbox);
      {% endfor %}
    }
  }
  if (valor=="radio4"){
    //console.log("algoaca");
    drawTableSchedule();
    $('#testsched').show();
    $('input[name="day"]').prop("disabled", false); 
  }
}

function funciondos(id_schedule){
  var valor = $('input[value*="radio"]:checked').val()
  if (valor=="radio1" || valor=="radio2" || valor=="radio3"){
    $('#testsched').hide();
    $('input[name="day"]').prop("disabled", true);
    return false;
  }
  else{  
    //drawTableSchedule();
    if(id_schedule<10){
      $('input[value*="0'+id_schedule+'_"]').prop("checked", !$('input[value*="'+id_schedule+'_"]').prop("checked"));
    }
    else{
      $('input[value*="'+id_schedule+'_"]').prop("checked", !$('input[value*="'+id_schedule+'_"]').prop("checked"));
    }
    
    $('input[value="radio4"]').prop("checked", true);
    if($('input[value="radio1"]').checked  || $('input[value="radio2"]').checked || $('input[value="radio3"]').checked){
      $('#testsched').hide();
      $('input[value="radio4"]').prop("checked", false);
    }
  }
}

function diaselect(dia){
  var valor = $('input[value*="radio"]:checked').val()
  $('table#sort_table').tablesorter({
    animation: 'slide',
    speed: 1200,
    sortList: [[0,0]]
  });
  if (valor=="radio1" || valor=="radio2" || valor=="radio3"){
    $('#testsched').hide();
    $('input[name="day"]').prop("disabled", true);
    return false;
  }
  else{
    //drawTableSchedule();
    $('input[value*="'+dia+'"]').prop("checked", !$('input[value*="'+dia+'"]').prop("checked"));
    $('input[value="radio4"]').prop("checked", true);
    if($('input[value="radio1"]').checked  || $('input[value="radio2"]').checked || $('input[value="radio3"]').checked){
      $('#testsched').hide();
      $('input[value="radio4"]').prop("checked", false);
    }
  }

}
</script>

{% endblock %}