{% extends 'home.html' %}

{% load static %}

{% block title %}Estadísticas{% endblock %}

{% block body2 %}

<script src="{% static 'js/editablegrid.js' %}"></script>
<script src="{% static 'js/editablegrid_renderers.js' %}"></script>
<script src="{% static 'js/editablegrid_editors.js' %}"></script>
<script src="{% static 'js/editablegrid_validators.js' %}"></script>
<script src="{% static 'js/editablegrid_utils.js' %}"></script>
<script src="{% static 'js/editablegrid_charts.js' %}"></script>
<!--<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/data.js"></script>
<script src="https://code.highcharts.com/modules/drilldown.js"></script>-->
<!--<script src="https://code.highcharts.com/5.0.3/highcharts.js"></script>
<script src="https://code.highcharts.com/5.0.3/modules/data.js"></script>
<script src="https://code.highcharts.com/5.0.3/modules/drilldown.js"></script>-->
<script src="{% static 'highcharts/highcharts5.0.3.js' %}"></script>
<script src="{% static 'highcharts/modules/drilldown5.0.3.js' %}"></script>

<link rel="stylesheet" type="text/css" href="{% static 'css/editablegrid.css'%}">
<link rel="stylesheet" type="text/css" href="{% static 'css/superstats.css'%}">
<!--<script type="text/javascript" src="{% static 'js/jquery.nicescroll.min.js' %}"></script>!-->

<style type="text/css">
  .chart div {
  font: 10px sans-serif;
  background-color: steelblue;
  text-align: right;
  padding: 13px;
  margin: 1px;
  color: white;
}

.widget {
    margin: 0 auto;
    width:1200px;
    margin-top:50px;
    background-color:#fff;
    -background-color: #222D3A;
    border-radius: 5px;
    box-shadow: 1px 1px 4px 0px rgba(0,0,0,0.3);

}

.header{
    background-color: #eee;
    height:40px;
    color:#555;
    text-align: center;
    line-height: 40px;
    /*border-top-left-radius: 7px;
    border-top-right-radius: 7px;*/
    font-weight: 400;
    font-size: 1.2em;
    text-shadow: 1px 1px #fff;
    border-bottom: 1px solid #eaeaea;
}

.chart-container{
    padding:25px;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}
</style>

<br>
<div class="principal" style="background-color: #f7f7f7;min-height: 500px;">
<br>
  <br>
  <h1 style="text-align:center;">Estadísticas</h1>
  <div class="contenedor" style="width:20%;float:left;">
  <br>
  <h2 align="center">Cursos</h2>
  <div id="contenedor">
  </div>
  </div>
  <div id="trabajo" style="width:50%;float:left;" class="trabajo">
    <br>
  <h2 align="center">Tipo de Trabajo</h2>
  <div id="testsched">
  
  </div>
  <br>
  <div align="left" style="margin-left:50px;float: left;width: 40%;">
  <input type="radio" name="seleccion" onclick="selectSchedule(this)" value="radio1">Todo <br>
  <input type="radio" name="seleccion" onclick="selectSchedule(this)" value="radio2">Horario de clases <br>
  <input type="radio" name="seleccion" onclick="selectSchedule(this)" value="radio3">Fuera horario de clases <br>
  <input type="radio" name="seleccion" onclick="selectSchedule(this)" value="radio4">Personalizado <br>  
  </div>
  <div align="left" style="margin-right:50px;float: left;width: 40%;">
  <input type="radio" name="seleccion" onclick="selectSchedule(this)" value="radio5">Todo vs Horario de clases <br>
  <input type="radio" name="seleccion" onclick="selectSchedule(this)" value="radio6">Todo vs Fuera horario de clases <br>
  <input type="radio" name="seleccion" onclick="selectSchedule(this)" value="radio7">Horario de clases vs Fuera horario de clases <br>
  </div>

</div>
  <div id="fechas" style="width:65%;float:left;height: 140px;" class="dates">
    <br>
    <h2 align="left" style="margin-left:200px;">Fechas</h2>
        <div  class="fechas" style="margin-left: 50px;">
          <p class="label_input"><strong id="fIniTooltip">Desde</strong></p>
          <input name="desde" onchange="validar()" onkeyup="validar()" id="desde" class="ui-corner-all placeholder simple-input search-input blur-on-esc skill_search" type="date" max="9999-12-31" placeholder="Desde"/>
        </div>
        <div  class="fechas">
          <p class="label_input"><strong id="fTerTooltip">Hasta</strong></p>
          <input name="hasta" onchange="validar()" onkeyup="validar()" id="hasta" class="ui-corner-all placeholder simple-input search-input blur-on-esc skill_search" type="date" max="9999-12-31" placeholder="Hasta"/>
        </div>
  </div>
  <div id="tipochapter" style="width:35%;float:left;height: 140px;" class="typechapt">
    <br>
    <br>
    <h2 align="left">Tipo de Currículum</h2>
    <select id="selectchapter" class="skill_search" style="margin-right: 150px">
      <OPTION VALUE="MK">Misiones Khan</OPTION>
      <OPTION VALUE="CK">Currículum Khan</OPTION>
    </select>
  </div>
<br>
    <div style="float:left;width:100%" align="center">
    <input type="button" id="button_realizar" onClick="crearEstadisticas();" class="kui-button kui-button-plain kui-button-primary" value="Ver estadísticas">
    <input type="button" id="button_last" onClick="mostrarLastChart()" class="kui-button kui-button-plain kui-button-primary" value="Volver a última búsqueda">
  </div>
</div>
  <div id="loading" class="popup" style="display:none">
      <div style="align:left;">
        <p class="response">Cargando los gráficos, esto puede demorar unos minutos</p>
        <div style="display: none;" id="profile-throbber2" class="profile-throbber">
        <div class="throbber-grid">   
            <!--[if lte IE 9]>
            <img class="throbber-fallback" src="/images/throbber-full.gif" />
            <![endif]-->
            <div class="throbber-row clearfix">
                 <div class="block-0 throbber-block"></div>
                 <div class="block-1 throbber-block"></div>
                 <div class="block-2 throbber-block"></div>
            </div>
            <div class="throbber-row clearfix">
                 <div class="block-7 throbber-block"></div>
                 <div class="block-8 throbber-block"></div>
                 <div class="block-3 throbber-block"></div>
            </div>
            <div class="throbber-row clearfix">
                 <div class="block-6 throbber-block"></div>
                 <div class="block-5 throbber-block"></div>
                 <div class="block-4 throbber-block"></div>
            </div>
        </div>
      </div>
      </div>
    </div>



</div>
<div class="graphics" id="graph" align="center">
<input type="button" id="button_parameter" onClick="containerShow()" class="kui-button kui-button-plain kui-button-primary" value="Definir parámetros">

<hr>
<div id="promediototaltot" style="float:left;width: 50%;"></div>
<div id="promediototaltot2" style="float:left;width: 50%;"></div>
<div id="containertot" style="min-width: 300px;  margin: 0 auto"></div>
<br>
<div id="ordencant">
<select id="ordenarcant" class="skill_search">
      <OPTION VALUE="0">Nombre</OPTION>
      <OPTION VALUE="1">Cantidad (ascendente)</OPTION>
      <OPTION VALUE="2">Cantidad (descendente)</OPTION>
      <OPTION VALUE="3">Promedio (ascendente)</OPTION>
      <OPTION VALUE="4">Promedio (descendente)</OPTION>
      <OPTION VALUE="5">Máximo (ascendente)</OPTION>
      <OPTION VALUE="6">Máximo (descendente)</OPTION>
      <OPTION VALUE="7">Mínimo (ascendente)</OPTION>
      <OPTION VALUE="8">Mínimo (descendente)</OPTION>
</select>
</div>
<hr>
<div id="promediototalej" style="float:left;width: 50%;"></div>
<div id="promediototalej2" style="float:left;width: 50%;"></div>
<div id="containerej" style="min-width: 300px; margin: 0 auto"></div>
<br>
<div id="ordentot">
<select id="ordenartot" class="skill_search">
      <OPTION VALUE="0">Nombre</OPTION>
      <OPTION VALUE="1">Tiempo (ascendente)</OPTION>
      <OPTION VALUE="2">Tiempo (descendente)</OPTION>
      <OPTION VALUE="3">Promedio (ascendente)</OPTION>
      <OPTION VALUE="4">Promedio (descendente)</OPTION>
      <OPTION VALUE="5">Máximo (ascendente)</OPTION>
      <OPTION VALUE="6">Máximo (descendente)</OPTION>
      <OPTION VALUE="7">Mínimo (ascendente)</OPTION>
      <OPTION VALUE="8">Mínimo (descendente)</OPTION>
</select>
</div>
<hr>
<div id="promediototalvid" style="float:left;width: 50%;"></div>
<div id="promediototalvid2" style="float:left;width: 50%;"></div>
<div id="containervid" style="min-width: 300px;  margin: 0 auto"></div>
<br>
<div id="ordenvid">
<select id="ordenarvid" class="skill_search">
      <OPTION VALUE="0">Nombre</OPTION>
      <OPTION VALUE="1">Tiempo (ascendente)</OPTION>
      <OPTION VALUE="2">Tiempo (descendente)</OPTION>
      <OPTION VALUE="3">Promedio (ascendente)</OPTION>
      <OPTION VALUE="4">Promedio (descendente)</OPTION>
      <OPTION VALUE="5">Máximo (ascendente)</OPTION>
      <OPTION VALUE="6">Máximo (descendente)</OPTION>
      <OPTION VALUE="7">Mínimo (ascendente)</OPTION>
      <OPTION VALUE="8">Mínimo (descendente)</OPTION>
</select>
</div>
<div class="widget">
    <div class="header">Misiones</div>
    <div id="chart" class="chart-container">
    
    </div>
</div>
</div>

<div id="popup" style="display:none">
	<div id="close">X</div>
</div>

<div id="popup_error" class="popup" style="display:none">
  <div id="close" onClick="$('#popup_error').fadeOut();$('#hover').fadeOut();">X</div>
</div>

<script>

    $(document).ready(function(){
        $('table#sort_table').tablesorter({
            animation: 'slide',
            speed: 1200,
            sortList: [[0,0], [0,1]]
        });

    });
    
    var tree = JSON.parse('{{ json_data | escapejs }}');
    //console.log(tree);
    $('#contenedor').jstree(tree);
    //drawNiceScrolls();
    //$('#loading').hide()
    stoploading();
    $('.graphics').hide();
    $('#testsched').hide();
    $('#button_last').hide();
      $("#hover").click(function(){
          $(this).fadeOut();
          $("#popup").fadeOut();
          $("#popup_error").fadeOut();
        });


function loading(){
      $('#popup_evaluacion').show();
      $('#hover').show();
      $('#profile-throbber2').show();
    }

function stoploading(){
      $('#popup_evaluacion').hide();
      $('#hover').hide();
      $('#profile-throbber2').hide();
}

$('#estadisticas').addClass('active selected');

$('input[name="day"]').prop("disabled", true);


function drawTableSchedule(){
  var tableSchedule='<table class="testsched" id="sort_table">';
  tableSchedule+="<thead><tr><th width='30%'>Horario</th><th width='10%' id='HSE' onclick='diaselect(\x22Monday\x22);'>Lunes</th>";
  tableSchedule+="<th width='10%' id='HSE' onclick='diaselect(\x22Tuesday\x22);'>Martes</th>";
  tableSchedule+="<th width='10%' id='HSE' onclick='diaselect(\x22Wednesday\x22);'>Miércoles</th>";
  tableSchedule+="<th width='10%' id='HSE' onclick='diaselect(\x22Thursday\x22);'>Jueves</th>";
  tableSchedule+="<th width='10%' id='HSE' onclick='diaselect(\x22Friday\x22);'>Viernes</th>";
  tableSchedule+="<th width='10%' id='HSE' onclick='diaselect(\x22Saturday\x22);'>Sábado</th>";
  tableSchedule+="<th width='10%' id='HSE' onclick='diaselect(\x22Sunday\x22);'>Domingo</th>";
  tableSchedule+="</tr></thead>"
  for(var i=0;i<24;i++){
    tableSchedule+="<tr id='"+i+"' class='nocolor'>";
    if(i<10){
      tableSchedule+="<th id='HSE' onclick='funciondos(0"+i+")'>0"+parseInt(0+i)+":00 - 0"+parseInt(0+i)+":59</th>"
      tableSchedule+="<td><input type='checkbox' value='0"+i+"_Monday' name='day"+i+"' id='checkschedule'></td>";
      tableSchedule+="<td><input type='checkbox' value='0"+i+"_Tuesday' name='day"+i+"' id='checkschedule'></td>";
      tableSchedule+="<td><input type='checkbox' value='0"+i+"_Wednesday' name='day"+i+"' id='checkschedule'></td>";
      tableSchedule+="<td><input type='checkbox' value='0"+i+"_Thursday' name='day"+i+"' id='checkschedule'></td>";
      tableSchedule+="<td><input type='checkbox' value='0"+i+"_Friday' name='day"+i+"' id='checkschedule'></td>";
      tableSchedule+="<td><input type='checkbox' value='0"+i+"_Saturday' name='day"+i+"' id='checkschedule'></td>";
      tableSchedule+="<td><input type='checkbox' value='0"+i+"_Sunday' name='day"+i+"' id='checkschedule'></td></tr>";
    }
    else{
      tableSchedule+="<th id='HSE' onclick='funciondos("+i+")'>"+parseInt(0+i)+":00 - "+parseInt(0+i)+":59</th>"
      tableSchedule+="<td><input type='checkbox' value='"+i+"_Monday' name='day"+i+"' id='checkschedule'></td>";
      tableSchedule+="<td><input type='checkbox' value='"+i+"_Tuesday' name='day"+i+"' id='checkschedule'></td>";
      tableSchedule+="<td><input type='checkbox' value='"+i+"_Wednesday' name='day"+i+"' id='checkschedule'></td>";
      tableSchedule+="<td><input type='checkbox' value='"+i+"_Thursday' name='day"+i+"' id='checkschedule'></td>";
      tableSchedule+="<td><input type='checkbox' value='"+i+"_Friday' name='day"+i+"' id='checkschedule'></td>";
      tableSchedule+="<td><input type='checkbox' value='"+i+"_Saturday' name='day"+i+"' id='checkschedule'></td>";
      tableSchedule+="<td><input type='checkbox' value='"+i+"_Sunday' name='day"+i+"' id='checkschedule'></td></tr>";
    }

  }
  tableSchedule+="</table>";
  document.getElementById('testsched').innerHTML = tableSchedule;

  $("th#HSE").mouseover(function(){
  $(this).css("background-color", "gray");
  $(this).css("color", "white");
  });
  $("th#HSE").mouseout(function(){
  $(this).css("background-color", "#ccc");
    $(this).css("color", "#555");
  });
}

function showDiv(){
  if( !($('.graphics').is(":visible")) ){
    $('.graphics').toggle('blind',1500)
}
}

function hideDiv(){
  if( $('.graphics').is(":visible") ){
    $('.graphics').toggle('blind',1500)
}
}

function showDivMain(){
  if( !($('.principal').is(":visible")) ){
    $('.principal').toggle('blind',1500)
}
}

function hideDivMain(){
  if( $('.principal').is(":visible") ){
    $('.principal').toggle('blind',1500)
}
}

function containerShow(){
  //$(".principal").fadeIn();
  showDivMain();
  hideDiv();
  //$('.graphics').fadeOut();
  //drawNiceScrolls();
}

function mostrarLastChart(){
  hideDivMain();
  showDiv();
}

function crearEstadisticas(){
  validar();
  var selhorario=[];

  var selinst=[];
  var selcurso=[];
  var curso = $("#contenedor").jstree("get_selected", true);
  //selcurso = (curso.indexOf("id_")>-1);
  for (var i=0;i<curso.length;i++){
    //console.log(curso[i]['parent']);
    if (curso[i]['id'].indexOf("id_")==false){
      selcurso.push(curso[i]['id']);

      if (selinst.indexOf(curso[i]['parent'])===-1){
        selinst.push(curso[i]['parent']);
      
      }
    }
  }
  
  var radioselect = $('input[value*="radio"]:checked').val();
  if (radioselect=="radio4"){
    selhorario = $('input[name*="day"]:checked').map(function(_,el){
      return $(el).val();
    }).get();
  }
  var typechapter = $('#selectchapter').val();
  //$('#loading').show()
  loading();
  if (validar() && selcurso.length>0 && radioselect){
    desde = document.getElementById("desde").value;
    hasta = document.getElementById("hasta").value;
    //$('.principal').fadeOut();
    if (radioselect=="radio1" || radioselect=="radio2" || radioselect=="radio3" || radioselect=="radio4"){
      $.ajax({
        url: "{% url 'SuperStats:selectSuperStats' %}",
        type: "POST",
        data: {selcurso, selinst, desde, hasta, radioselect, selhorario, typechapter},
          success: function(response){
            jsonResponse = JSON.parse(response);
            hideDivMain();
            showDiv();
            //console.log(response);
            //$('#loading').hide()
            stoploading();
            graficar(jsonResponse, selinst);
          }
      });
    }
    else{
      $.ajax({
        url: "{% url 'SuperStats:compareSuperStats' %}",
        type: "POST",
        data: {selcurso, selinst, desde, hasta, radioselect},
          success: function(response){
            jsonResponse = JSON.parse(response);
            hideDivMain();
            showDiv();
            $('#button_last').show();
            $('.widget').hide();
            //$('#loading').hide()
            stoploading();
            graficarcompara(jsonResponse, selinst);
          }
      });
    }
  }
  else{
    $('#popup_error').empty();
    $('#popup_error').append("<p>Faltan datos por seleccionar, revise los campos.</p>")
    $('#popup_error').fadeIn().css('display', '');
    $("#hover").fadeIn().css('display', '');
  }
  
}

function graficar(json, clase){
  //console.log(json);
  $('#ordenartot').show();
  $('#ordenarvid').show();
  $('#ordenarcant').show();
  var colorScale = d3.scale.ordinal().range(['#1c758a'])
    .domain(['KhanBlue']);
  var arrayte=[];
  var arraytv=[];
  var arraycant=[];
  var colors=['blue', 'red', 'green', 'yellow', 'orange', 'brown', 'gray'];
  var serie=[];
  var serietpo=[];
  var serievid=[];
  var j;
  var mission=[];
  if(json["clases"]){
    var clase = json["clases"]
    var colorcolumn=[];
    var arregloclase=[];
    for (var i=0;i<clase.length;i++){
      var datosest=[];
      var tpoest=[];
      var videst=[];
      var curso=clase[i]["nombre"];
      var ee=clase[i]["establecimiento"]
      var tpo_ejercicios = clase[i]["tiempo_ejercicios_clase"]
      var tpo_videos = clase[i]["tiempo_videos_clase"]
      var cantidad = clase[i]["total_ejercicios_clase"]
      var nombre = curso +" - "+ee
      var estudiantes = clase[i]["students"];
      var cantidad_clase = clase[i]["cantidad_clases"]
      var tiempo_esperado = clase[i]["tiempo_esperado"]
      var maxtpoejer=0;
      var maxtpovid=0;
      var maxtotejer=0;
      var mintpoejer=99999999;
      var mintpovid=99999999;
      var mintotejer=99999999;
      var estudtrabtpoejer=0;
      var estudtrabtpovid=0;
      var estudtrabcantejer=0;
      for (j=0;j<estudiantes.length;j++){
        datosest[j]=[estudiantes[j]["name"], estudiantes[j]["total_ejercicios"]];
        tpoest[j]=[estudiantes[j]["name"], estudiantes[j]["tiempo_ejercicios"]];
        videst[j]=[estudiantes[j]["name"], estudiantes[j]["tiempo_videos"]];
        if (estudiantes[j]["total_ejercicios"]>maxtotejer){
          maxtotejer=estudiantes[j]["total_ejercicios"];
        }
        if (estudiantes[j]["tiempo_ejercicios"]>maxtpoejer){
          maxtpoejer=estudiantes[j]["tiempo_ejercicios"];
        }
        if (estudiantes[j]["tiempo_videos"]>maxtpovid){
          maxtpovid=estudiantes[j]["tiempo_videos"];
        }
        if (estudiantes[j]["total_ejercicios"]<mintotejer && estudiantes[j]["total_ejercicios"]!=0){
          mintotejer=estudiantes[j]["total_ejercicios"];
        }
        if (estudiantes[j]["tiempo_ejercicios"]<mintpoejer && estudiantes[j]["tiempo_ejercicios"]!=0){
          mintpoejer=estudiantes[j]["tiempo_ejercicios"];
        }
        if (estudiantes[j]["tiempo_videos"]<mintpovid && estudiantes[j]["tiempo_videos"]!=0){
          mintpovid=estudiantes[j]["tiempo_videos"];
        }
        if (estudiantes[j]["total_ejercicios"]>0){
          estudtrabcantejer++;
        }
        if (estudiantes[j]["tiempo_ejercicios"]>0){
          estudtrabtpoejer++;
        }
        if (estudiantes[j]["tiempo_videos"]>0){
          estudtrabtpovid++;
        }
      }
      //var colorcolumn={"color":colors[i]};
      if (ee=="LSMB"){
        colorcolumn[i]='#84C8D7';
      }
      if (ee=="E.A."){
        colorcolumn[i]='#D7212A';
      }
      if (ee=="C.E.I."){
        colorcolumn[i]='#009900';
      }
      if (ee=="L.A.V."){
        colorcolumn[i]='#CCCC00';
      }
      if (ee=="R.A.P."){
        colorcolumn[i]='#FF8000';
      }
      if (ee=="G.M."){
        colorcolumn[i]='#663300';
      }
      if (ee=="BA-Khan"){
        colorcolumn[i]='#808080';
      }
      /*arrayte[i]=[nombre, tpo_ejercicios]
      arraytv[i]=[nombre, tpo_videos]
      arraycant[i]=[nombre, cantidad]*/

      arrayte[i]={"name":nombre, "y": tpo_ejercicios, "drilldown":nombre, "cantidad":estudiantes.length, "trabajaron":estudtrabtpoejer, "maximo":maxtpoejer, "minimo":mintpoejer, "promedio":tpo_ejercicios/estudiantes.length, "cantclase":cantidad_clase, "tpo_esperado":tiempo_esperado};
      serietpo[i]={"name":nombre, "id":nombre, "data":tpoest, "tooltip":{"pointFormat": 'Tiempo de ejercicios: <b>{point.y:,.2f}</b>'}};

      arraytv[i]={"name":nombre, "y": tpo_videos, "drilldown":nombre, "cantidad":estudiantes.length, "trabajaron":estudtrabtpovid, "maximo":maxtpovid, "minimo":mintpovid, "promedio":tpo_videos/estudiantes.length, "cantclase":cantidad_clase, "est_vid_out":clase[i]["estudiantes_out_vid"]};
      serievid[i]={"name":nombre, "id":nombre, "data":videst, "tooltip":{"pointFormat": 'Tiempo de videos: <b>{point.y:,.2f}</b>'}};

      arraycant[i]={"name":nombre, "y": cantidad, "drilldown":nombre, "cantidad":estudiantes.length, "trabajaron":estudtrabcantejer, "maximo":maxtotejer, "minimo":mintotejer, "promedio":cantidad/estudiantes.length, "cantclase":cantidad_clase, "est_out": clase[i]["estudiantes_out"]}
      serie[i]={"name":nombre, "id":nombre, "data":datosest, "tooltip":{"pointFormat": 'Cantidad de ejercicios: <b>{point.y:,.0f} ejercicios</b>'}};

      var arrayskill;
      //var misiones = clase[i]["misiones"];
      //var pointarrayte = 'Tiempo de ejercicios: <b>{point.y:,.0f} segundos</b><br> Cantidad de estudiantes: <b>{point.cantidad}</b><br> Estudiantes que trabajaron: <b>{point.trabajaron}</b> <br>Máximo: <b>{point.maximo:,.0f} segundos</b><br> Mínimo: <b>{point.minimo:,.0f} segundos</b><br> Promedio: <b>{point.promedio:,.1f} segundos</b> <br>Cantidad de clases: <b>{point.cantclase} clases</b> <br>Tiempo promedio esperado: <b>{point.tpo_esperado:,.0f} segundos</b>';

      /*if (clase[i]["estudiantes_out_vid"]==0){
        var pointarraytv = 'Tiempo de videos: <b>{point.y:,.0f} segundos</b><br> Cantidad de estudiantes: <b>{point.cantidad}</b><br> Estudiantes que trabajaron: <b>{point.trabajaron}</b> <br>Máximo: <b>{point.maximo:,.0f} segundos</b><br> Mínimo: <b>{point.minimo:,.0f} segundos</b><br> Promedio: <b>{point.promedio:,.1f} segundos</b> <br>Cantidad de clases: <b>{point.cantclase} clases</b>';
      }
      else{
        var pointarraytv = 'Tiempo de videos: <b>{point.y:,.0f} segundos</b><br> Cantidad de estudiantes: <b>{point.cantidad}</b><br> Estudiantes que trabajaron: <b>{point.trabajaron}</b> <br>Máximo: <b>{point.maximo:,.0f} segundos</b><br> Mínimo: <b>{point.minimo:,.0f} segundos</b><br> Promedio: <b>{point.promedio:,.1f} segundos</b> <br>Cantidad de clases: <b>{point.cantclase} clases</b> <br>Estudiantes fuera de horario de clase: <b>{point.est_vid_out}</b>';
      }*/
      
      if (clase[i]["estudiantes_out"]==0){
        var pointarraycant = 'Cantidad de ejercicios: <b>{point.y} ejercicios</b><br> Cantidad de estudiantes: <b>{point.cantidad}</b><br> Estudiantes que trabajaron: <b>{point.trabajaron}</b> <br>Máximo: <b>{point.maximo} ejercicios</b><br> Mínimo: <b>{point.minimo} ejercicios</b><br> Promedio: <b>{point.promedio:,.1f} ejercicios</b> <br>Cantidad de clases: <b>{point.cantclase} clases</b>';
      }
      else{
        var pointarraycant = 'Cantidad de ejercicios: <b>{point.y} ejercicios</b><br> Cantidad de estudiantes: <b>{point.cantidad}</b><br> Estudiantes que trabajaron: <b>{point.trabajaron}</b> <br>Máximo: <b>{point.maximo} ejercicios</b><br> Mínimo: <b>{point.minimo} ejercicios</b><br> Promedio: <b>{point.promedio:,.1f} ejercicios</b> <br>Cantidad de clases: <b>{point.cantclase} clases</b> <br>Estudiantes fuera de horario de clase: <b>{point.est_out}</b>';
      }
      /*
      for (var k=0;k<misiones.length;k++){
        arrayskill = false;
        var habilidades=misiones[k]["habilidades"]
        for (var l=0;l<habilidades.length;l++){
          var maestria1=habilidades[l]["nivel"]["mastery1"];
          var maestria2=habilidades[l]["nivel"]["mastery2"];
          var dominado=habilidades[l]["nivel"]["mastery3"];
          var practicado=habilidades[l]["nivel"]["practiced"];
          var noempezado=habilidades[l]["nivel"]["unstarted"];
          var enproblemas=habilidades[l]["nivel"]["struggling"];
          if (maestria1>0 || maestria2>0 || dominado>0 || practicado>0 || noempezado>0 || enproblemas>0){
            arrayskill=true;
          }
        }
        if (arrayskill===false){
          delete misiones[k];
        }
      }

      var valormision=0;
      var arreglocurso=[];
      for (var m=0;m<misiones.length;m++){
        try{
          var largo=misiones[m]["habilidades"].length
          //datos[0][n]=largo;
          //datos[1][n]=curso;
          //console.log(misiones[m]["mision"])
          if (mission.indexOf(misiones[m]["mision"])===-1){
            mission.push(misiones[m]["mision"])
          }
          //datos[2][n]=misiones[m]["mision"];
          //n++;
          var datap=[];
          for (var p=0;p<largo;p++){
            var id = misiones[m]["habilidades"][p]["id"]
            var M3 = misiones[m]["habilidades"][p]["nivel"]["mastery3"]
            var M2 = misiones[m]["habilidades"][p]["nivel"]["mastery2"]
            var M1 = misiones[m]["habilidades"][p]["nivel"]["mastery1"]
            var PR = misiones[m]["habilidades"][p]["nivel"]["practiced"]
            var UN = misiones[m]["habilidades"][p]["nivel"]["unstarted"]
            var ST = misiones[m]["habilidades"][p]["nivel"]["struggling"]
            var nombre = misiones[m]["habilidades"][p]["nombre_skill"]
            //console.log(nombre)
            datap[p]={"id":id, "A":parseInt(M3*100/estudiantes.length), "B":parseInt(M2*100/estudiantes.length), "C":parseInt(M1*100/estudiantes.length), "D":parseInt(PR*100/estudiantes.length), "E":parseInt(UN*100/estudiantes.length), "F":parseInt(ST*100/estudiantes.length), "G":100-parseInt(M1*100/estudiantes.length)-parseInt(M2*100/estudiantes.length)-parseInt(M3*100/estudiantes.length)-parseInt(PR*100/estudiantes.length)-parseInt(UN*100/estudiantes.length)-parseInt(ST*100/estudiantes.length), "mision":misiones[m]["mision"], "curso":clase[i]["nombre"], "establecimiento":clase[i]["establecimiento"],"nombre":nombre};
            //n++;
          }
          arreglocurso[valormision]=datap;

          valormision++;
        }
        catch(e){
          continue;
        }
      }
      arregloclase[i]=arreglocurso;*/
    }
  }
  else{
    if(json["students"]){
      var student = json["students"]
      for (var j=0;j<student.length;j++){
        var name=student[j]["name"]
        var tpo_ejercicios = student[j]["tiempo_ejercicios"]
        var tpo_videos = student[j]["tiempo_videos"]
        var cantidad = student[j]["total_ejercicios"]
        arrayte[j]=[name, tpo_ejercicios]
        arraytv[j]=[name, tpo_videos]
        arraycant[j]=[name, cantidad]
      }
    }
    var pointarrayte='Tiempo de ejercicios: <b>{point.y:,.0f} segundos</b>';
    var pointarraytv = 'Tiempo de videos: <b>{point.y:,.0f} segundos</b>';
    var pointarraycant = 'Cantidad de ejercicios: <b>{point.y} ejercicios</b>';
  }
  
  /*try{
    var nombremision = 'sin nombre';
    var dataq=arregloclase;
    for (var t = 0; t < mission.length; t++) {
      //mission[i]
      for (var i = 0; i < dataq.length; i++) {
        //console.log(curso=dataq[i][0][0]["curso"]); //nombre curso
        var misiones = dataq[i];
        for (var j = 0; j < misiones.length; j++) {
          //console.log(misiones[j][0]["mision"]); //nombre mision
          
          if (mission[t]==misiones[j][0]["mision"]){
            var habilidades = misiones[j];
            var data=[];
            for (var k = 0; k < habilidades.length; k++) {
              var id = habilidades[k]["id"];
              var A = habilidades[k]["A"];
              var B = habilidades[k]["B"];
              var C = habilidades[k]["C"];
              var D = habilidades[k]["D"];
              var E = habilidades[k]["E"];
              var F = habilidades[k]["F"];
              var G = habilidades[k]["G"];
              var mision = misiones[j][0]["mision"];
              var curso = dataq[i][0][0]["curso"];
              var nombre = habilidades[k]["nombre"];
              var establecimiento = dataq[i][0][0]["establecimiento"];
              //console.log(nombre)
              data[k]={"id":id, "A":A, "B":B, "C":C, "D":D, "E":E, "F":F, "G":G, "mis":mision, "cur":curso+" - "+establecimiento, "nombre":nombre}
            }

            var xData = ["A", "B", "C", "D", "E", "F", "G"];
            var margin = {top: 10, right: 200, bottom: 0, left: 0},
            width = 1200 - margin.left - margin.right,
            height = 15;
                  //height = 60 - margin.top - margin.bottom;
            var x = d3.scale.ordinal()
                  .rangeRoundBands([0, width], 0.09);
            var y = d3.scale.linear()
                  .rangeRound([height, 0]);
            var color = d3.scale.ordinal()
                  .range(["#1C758A", "#29ABCA", "#58C4DD", "#9CDCEB", "#808080", "#C30202","#B0B0B0"]);
            var xAxis = d3.svg.axis()
                  .scale(x)
                  .orient("bottom");

            var svg = d3.select("#chart").append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");       

            var dataIntermediate = xData.map(function (c) {
                return data.map(function (d) {
                    return {x: d.id, y: d[c], nombre:d.nombre, A: d.A, B: d.B, C: d.C, D: d.D, E: d.E, F: d.F, G: d.G, cur: d.cur};
                });
            });

            var dataStackLayout = d3.layout.stack()(dataIntermediate);

            x.domain(dataStackLayout[0].map(function (d) {
                return d.x;
            }));

            y.domain([0,
                d3.max(dataStackLayout[dataStackLayout.length - 1],
                        function (d) { return d.y0 + d.y;})
                ])
              .nice();

            var layer = svg.selectAll(".stack")
                    .data(dataStackLayout)
                    .enter().append("g")
                    .attr("class", "stack")
                    .style("fill", function (d, i) {
                        return color(i);
                    });

            if (nombremision==misiones[j][0]["mision"]){
              nombremision = misiones[j][0]["mision"];
            }
            else{
              var text = layer
                    .append('text')
                    .text(mission[t])
                    .attr("y", height-5)
                    .style('fill', 'black')
              nombremision = misiones[j][0]["mision"];
            }

            layer.selectAll("rect")
                    .data(function (d) {
                      //console.log(d);
                        return d;
                    })
                    .enter().append("rect")
                    .attr("x", function (d, i) {
                        return 4.2*i+200;
                    })
                    .attr("y", function (d) {
                        return y(d.y + d.y0);
                    })
                    .attr("height", function (d) {
                        return y(d.y0) - y(d.y + d.y0);
                    })
                    .attr("width", 3.2);
            $('rect').tipsy({
              gravity: $.fn.tipsy.autoNS,
              opacity: 1,
              html: true, 
              title: function(){
                var d = this.__data__;
                tooltp =("<ul><li style='text-align:center;'><font color='#000000'>Curso: </font>"+d.cur+"</li><li style='text-align:left;'><strong><font color='#000000'>Habilidad: </font>"+d.nombre+"</li><li style='text-align:left;'><strong><font color='#1C758A'>Dominado: </font>"+d.A+"%</li><li style='text-align:left;'><strong><font color='#29ABCA'>Nivel 2: </font>"+d.B+"%</li><li style='text-align:left;'><strong><font color='#58C4DD'>Nivel 1: </font>"+d.C+"%</li><li style='text-align:left;'><strong><font color='#9CDCEB'>Practicado: </font>"+d.D+"%</li><li style='text-align:left;'><strong><font color='#808080'>Necesita práctica: </font>"+d.E+"%</li><li style='text-align:left;'><strong><font color='#C30202'>En dificultad: </font>"+d.F+"%</li><li style='text-align:left;'><strong><font color='#B0B0B0'>Sin datos: </font>"+d.G+"%</li></strong></ul>");
                return tooltp
              }
            });

            var textcurso = layer
                    .append('text')
                    .text(curso+' - '+establecimiento)
                    .attr("x", 1000)
                    .attr("y", height/2)
                    .style("font-size", "12px")
                    //.style("font-family", "sans-serif")
                    .style('fill', 'black');

            svg.append("g")
                    .attr("class", "axis")
                    .attr("transform", "translate(0," + height + ")");

          }
        }
      }
    }
}
  catch(e){
    console.log(e);
  }*/

  var maxte=0;
  for (var j=0;j<arrayte.length;j++){
    if (arrayte[j]["y"]>maxte){
      maxte = arrayte[j]["y"];
    }
  }
  if (maxte>=3600){
    for (var j=0;j<arrayte.length;j++){
      arrayte[j]["y"]=arrayte[j]["y"]/3600;
    }
    for (var k = 0; k < serietpo.length; k++) {
      var datadrill = serietpo[k]["data"];
      for (var l = 0; l < datadrill.length; l++) {
        datadrill[l][1]=datadrill[l][1]/3600;
      }
    }
    //serietpo[i]["data"]=serietpo[i]["data"]/3600;
    var ejerText= 'Tiempo (horas)';
    //var ejerPoint = 'Tiempo de ejercicios: <b>{point.y:,.2f} horas</b>';
    var formato = '{point.y:,.2f}';
    var pointarrayte = 'Tiempo de ejercicios: <b>{point.y:,.2f} horas</b><br> Total de estudiantes: <b>{point.cantidad}</b><br> Estudiantes que trabajaron: <b>{point.trabajaron}</b> <br>Máximo: <b>{point.maximo:,.0f} segundos</b><br> Mínimo: <b>{point.minimo:,.0f} segundos</b><br> Promedio: <b>{point.promedio:,.1f} segundos</b> <br>Cantidad de clases: <b>{point.cantclase} clases</b> <br>Tiempo promedio esperado: <b>{point.tpo_esperado:,.0f} segundos</b>';
  }
  else if(maxte<3600 && maxte>=60){
    for (var j=0;j<arrayte.length;j++){
      arrayte[j]["y"]=arrayte[j]["y"]/60;
    }
    for (var k = 0; k < serietpo.length; k++) {
      var datadrill = serietpo[k]["data"];
      for (var l = 0; l < datadrill.length; l++) {
        datadrill[l][1]=datadrill[l][1]/60;
      }
    }
    var ejerText= 'Tiempo (minutos)';
    //var ejerPoint = 'Tiempo de ejercicios: <b>{point.y:,.2f} minutos</b>';
    var formato = '{point.y:,.2f}';
    var pointarrayte = 'Tiempo de ejercicios: <b>{point.y:,.2f} minutos</b><br> Total de estudiantes: <b>{point.cantidad}</b><br> Estudiantes que trabajaron: <b>{point.trabajaron}</b> <br>Máximo: <b>{point.maximo:,.0f} segundos</b><br> Mínimo: <b>{point.minimo:,.0f} segundos</b><br> Promedio: <b>{point.promedio:,.1f} segundos</b> <br>Cantidad de clases: <b>{point.cantclase} clases</b> <br>Tiempo promedio esperado: <b>{point.tpo_esperado:,.0f} segundos</b>';
  }
  else{
    var ejerText= 'Tiempo (segundos)';
    //var ejerPoint = 'Tiempo de ejercicios: <b>{point.y} segundos</b>';
    var formato = '{point.y:,.0f}';
    var pointarrayte = 'Tiempo de ejercicios: <b>{point.y:,.0f} segundos</b><br> Total de estudiantes: <b>{point.cantidad}</b><br> Estudiantes que trabajaron: <b>{point.trabajaron}</b> <br>Máximo: <b>{point.maximo:,.0f} segundos</b><br> Mínimo: <b>{point.minimo:,.0f} segundos</b><br> Promedio: <b>{point.promedio:,.1f} segundos</b> <br>Cantidad de clases: <b>{point.cantclase} clases</b> <br>Tiempo promedio esperado: <b>{point.tpo_esperado:,.0f} segundos</b>';
  }
  //console.log(maxte);

    var maxtv=0;
  for (var j=0;j<arraytv.length;j++){
    if (arraytv[j]["y"]>maxtv){
      maxtv = arraytv[j]["y"];
    }
  }
  if (maxtv>=3600){
    for (var j=0;j<arraytv.length;j++){
      arraytv[j]["y"]=arraytv[j]["y"]/3600;
    }
    for (var k = 0; k < serievid.length; k++) {
      var datadrill = serievid[k]["data"];
      for (var l = 0; l < datadrill.length; l++) {
        datadrill[l][1]=datadrill[l][1]/3600;
      }
    var pointarraytv = 'Tiempo de videos: <b>{point.y:,.2f} horas</b><br> Total de estudiantes: <b>{point.cantidad}</b><br> Estudiantes que trabajaron: <b>{point.trabajaron}</b> <br>Máximo: <b>{point.maximo:,.0f} segundos</b><br> Mínimo: <b>{point.minimo:,.0f} segundos</b><br> Promedio: <b>{point.promedio:,.1f} segundos</b> <br>Cantidad de clases: <b>{point.cantclase} clases</b> <br>Estudiantes fuera de horario de clase: <b>{point.est_vid_out}</b>';
    }
    var vidText= 'Tiempo (horas)';
    //var vidPoint = 'Tiempo de videos: <b>{point.y:,.2f} horas</b>';
    var formato = '{point.y:,.2f}';
  }
  else if(maxtv<3600 && maxtv>=60){
    for (var j=0;j<arraytv.length;j++){
      arraytv[j]["y"]=arraytv[j]["y"]/60;
    }
    for (var k = 0; k < serievid.length; k++) {
      var datadrill = serievid[k]["data"];
      for (var l = 0; l < datadrill.length; l++) {
        datadrill[l][1]=datadrill[l][1]/60;
      }
    var pointarraytv = 'Tiempo de videos: <b>{point.y:,.2f} minutos</b><br> Total de estudiantes: <b>{point.cantidad}</b><br> Estudiantes que trabajaron: <b>{point.trabajaron}</b> <br>Máximo: <b>{point.maximo:,.0f} segundos</b><br> Mínimo: <b>{point.minimo:,.0f} segundos</b><br> Promedio: <b>{point.promedio:,.1f} segundos</b> <br>Cantidad de clases: <b>{point.cantclase} clases</b> <br>Estudiantes fuera de horario de clase: <b>{point.est_vid_out}</b>';
    }
    var vidText= 'Tiempo (minutos)';
    //var vidPoint = 'Tiempo de videos: <b>{point.y:,.2f} minutos</b>';
    var formato = '{point.y:,.2f}';
  }
  else{
    var vidText= 'Tiempo (segundos)';
    //var vidPoint = 'Tiempo de videos: <b>{point.y} segundos</b>';
    var formato = '{point.y:,.0f}';
    var pointarraytv = 'Tiempo de videos: <b>{point.y:,.0f} segundos</b><br> Total de estudiantes: <b>{point.cantidad}</b><br> Estudiantes que trabajaron: <b>{point.trabajaron}</b> <br>Máximo: <b>{point.maximo:,.0f} segundos</b><br> Mínimo: <b>{point.minimo:,.0f} segundos</b><br> Promedio: <b>{point.promedio:,.1f} segundos</b> <br>Cantidad de clases: <b>{point.cantclase} clases</b> <br>Estudiantes fuera de horario de clase: <b>{point.est_vid_out}</b>';
  }

  $(function () {
    Highcharts.setOptions({
          lang:{
          decimalPoint: ",",
          thousandsSep: ".",
          downloadJPEG: "Descargar imagen JPEG",
          downloadPDF: "Descargar documento PDF",
          downloadPNG: "Descargar imagen PNG",
          downloadSVG: "Descargar imagen vectorial SVG",
          printChart: "Imprimir gráfico",
          drillUpText: "Volver a {series.name}"
        }
      });
      var chart = new Highcharts.Chart({
        chart: {
            renderTo: 'containerej',
            type: 'column',
            events: {
              drilldown: function(e){
                $('#ordenartot').hide();
              },
              drillup: function(e){
                $('#ordenartot').show();
              }
            }
        },
        title: {
            text: 'Tiempo de ejercicios'
        },
        subtitle: {
            text: 'Fuente: <a href="https://es.khanacademy.org/">Khan Academy</a>'
        },
        xAxis: {
            type: 'category',
            labels: {
                rotation: -45,
                style: {
                    fontSize: '11px',
                    fontFamily: 'Verdana, sans-serif'
                }
            }
        },
        yAxis: {
            min: 0,
            title: {
                //text: 'Tiempo (segundos)'
                text: ejerText
            }
        },
        legend: {
            enabled: false
        },
        colors: colorcolumn,
        series: [{
            name: 'Cursos',
            data: arrayte,
            colorByPoint: true,
            dataLabels: {
                enabled: true,
                rotation: -90,
                //color: 'KhanBlue',
                align: 'right',
                //format: '{point.y:,.0f}', // one decimal
                format: formato,
                y: 10, // 10 pixels down from the top
                style: {
                    fontSize: '11px',
                    fontFamily: 'Verdana, sans-serif'
                }
            },
            tooltip: {
            pointFormat: pointarrayte
            }
        }],
        drilldown: {
            series: serietpo
        }
    });
      function sortTotal(valor){
      //aqui va algo
      if (valor=="0"){
        arrayte.sort(function(a,b){
          return ((a.name < b.name) ? -1 : ((a.name > b.name) ? 1 : 0));
        });
      }
      if (valor=="1"){
        arrayte.sort(function(a,b){
          return parseInt(a.y) - parseInt(b.y);
        });
      }
      if (valor=="2"){
        arrayte.sort(function(a,b){
          return parseInt(b.y) - parseInt(a.y);
        });
      }
      /*arrayte.sort(function(a,b){
          return parseInt(b.y) - parseInt(a.y);
        });
        */
      return arrayte;
    }

    $('#ordenartot').change(function(){
      var retorno = sortTotal($('select#ordenartot option:selected').val());
      //console.log(retorno);
      chart.series[0].update(retorno);
    })
  });

  $(function () {
    Highcharts.setOptions({
          lang:{
          decimalPoint: ",",
          thousandsSep: ".",
          downloadJPEG: "Descargar imagen JPEG",
          downloadPDF: "Descargar documento PDF",
          downloadPNG: "Descargar imagen PNG",
          downloadSVG: "Descargar imagen vectorial SVG",
          printChart: "Imprimir gráfico",
          drillUpText: "Volver a {series.name}",
        }
      });
      var chart = new Highcharts.Chart({
        chart: {
            renderTo: 'containervid',
            type: 'column',
            events: {
              drilldown: function(e){
                $('#ordenarvid').hide();
              },
              drillup: function(e){
                $('#ordenarvid').show();
              }
            }
        },
        title: {
            text: 'Tiempo de videos'
        },
        subtitle: {
            text: 'Fuente: <a href="https://es.khanacademy.org/">Khan Academy</a>'
        },
        xAxis: {
            type: 'category',
            labels: {
                rotation: -45,
                style: {
                    fontSize: '11px',
                    fontFamily: 'Verdana, sans-serif'
                }
            }
        },
        yAxis: {
            min: 0,
            title: {
                //text: 'Tiempo (segundos)'
                text: vidText
            }
        },
        legend: {
            enabled: false
        },
        colors: colorcolumn,
        series: [{
            name: 'Cursos',
            data: arraytv,
            colorByPoint: true,
            dataLabels: {
                enabled: true,
                rotation: -90,
                //color: 'KhanBlue',
                align: 'right',
                //format: '{point.y:,.0f}', // one decimal
                format: formato,
                y: 10, // 10 pixels down from the top
                style: {
                    fontSize: '11px',
                    fontFamily: 'Verdana, sans-serif'
                }
            },
            tooltip: {
            pointFormat: pointarraytv
            }
        }],
        drilldown: {
            series: serievid
          }
    });
      function sortTotal(valor){
      //aqui va algo
      if (valor=="0"){
        arraytv.sort(function(a,b){
          return ((a.name < b.name) ? -1 : ((a.name > b.name) ? 1 : 0));
        });
      }
      if (valor=="1"){
        arraytv.sort(function(a,b){
          return parseInt(a.y) - parseInt(b.y);
        });
      }
      if (valor=="2"){
        arraytv.sort(function(a,b){
          return parseInt(b.y) - parseInt(a.y);
        });
      }

      return arraytv;
    }

    $('#ordenarvid').change(function(){
      var retorno = sortTotal($('select#ordenarvid option:selected').val());
      //console.log(retorno);
      chart.series[0].update(retorno);
    })
  });

  $(function () {
    Highcharts.setOptions({
          lang:{
          decimalPoint: ",",
          thousandsSep: ".",
          downloadJPEG: "Descargar imagen JPEG",
          downloadPDF: "Descargar documento PDF",
          downloadPNG: "Descargar imagen PNG",
          downloadSVG: "Descargar imagen vectorial SVG",
          printChart: "Imprimir gráfico",
          drillUpText: "Volver a {series.name}",
        }
      });
    var chart = new Highcharts.Chart({
        chart: {
            renderTo: 'containertot',
            type: 'column',
            events: {
              drilldown: function(e){
                $('#ordenarcant').hide();
              },
              drillup: function(e){
                $('#ordenarcant').show();
              }
            }
        },
        title: {
            text: 'Cantidad de ejercicios'
        },
        subtitle: {
            text: 'Fuente: <a href="https://es.khanacademy.org/">Khan Academy</a>'
        },
        xAxis: {
            type: 'category',
            labels: {
                rotation: -45,
                style: {
                    fontSize: '11px',
                    fontFamily: 'Verdana, sans-serif'
                }
            }
        },
        yAxis: {
            min: 0,
            title: {
                text: 'Cantidad (ejercicios)'
            }
        },
        legend: {
            enabled: false
        },
        colors: colorcolumn,
        series: [{
            name: 'Cursos',
            data: arraycant,
            colorByPoint: true,
            dataLabels: {
                enabled: true,
                rotation: -90,
                //color: 'KhanBlue',
                align: 'right',
                format: '{point.y:,.0f}', // one decimal
                y: 10, // 10 pixels down from the top
                style: {
                    fontSize: '11px',
                    fontFamily: 'Verdana, sans-serif'
                }
            },
            tooltip: {
              pointFormat: pointarraycant
            },
        }],
        drilldown: {
            series: serie
          }
    });
    function sortTotal(valor){
      //aqui va algo
      if (valor=="0"){
        arraycant.sort(function(a,b){
          return ((a.name < b.name) ? -1 : ((a.name > b.name) ? 1 : 0));
        });
      }
      if (valor=="1"){
        arraycant.sort(function(a,b){
          return parseInt(a.y) - parseInt(b.y);
        });
      }
      if (valor=="2"){
        arraycant.sort(function(a,b){
          return parseInt(b.y) - parseInt(a.y);
        });
      }
      /*arrayte.sort(function(a,b){
          return parseInt(b.y) - parseInt(a.y);
        });
        */
      return arraycant;
    }

    $('#ordenarcant').change(function(){
      var retorno = sortTotal($('select#ordenarcant option:selected').val());
      //console.log(retorno);
      chart.series[0].update(retorno);
    })
  });
}

function graficarcompara(json, clase){
  //console.log(json)
  $('#promediototaltot').empty();
  $('#promediototaltot2').empty();
  $('#promediototalej').empty();
  $('#promediototalej2').empty();
  $('#promediototalvid').empty();
  $('#promediototalvid2').empty();
  $('#ordenarcant').show();
  $('#ordenarvid').show();
  $('#ordenartot').show();
  var colorScale = d3.scale.ordinal().range(['#1c758a'])
    .domain(['KhanBlue']);
  var arrayte=[];
  var arraytv=[];
  var arraycant=[]; 
  var categorias=[];
  var tpoejercicios1=[];
  var tpoejercicios2=[];
  var tpovideos1=[];
  var tpovideos2=[];
  var cantidad1=[];
  var cantidad2=[];

  var j;
  if(json["clases"]){
    var clase = json["clases"]
    var tipo1 = clase[0]["tipo1"]
    var tipo2 = clase[0]["tipo2"]

    var totaltodos1=0;
    var promediotodos1=0;
    var maximotodos1=0;
    var minimotodos1=99999999;
    var totaltodos2=0;
    var promediotodos2=0;
    var maximotodos2=0;
    var minimotodos2=99999999;
    var promediomasalto1=0;
    var promediomasbajo1=99999999;
    var promediomasalto2=0;
    var promediomasbajo2=99999999;

    var totaltodos1v=0;
    var promediotodos1v=0;
    var maximotodos1v=0;
    var minimotodos1v=99999999;
    var totaltodos2v=0;
    var promediotodos2v=0;
    var maximotodos2v=0;
    var minimotodos2v=99999999;
    var promediomasalto1v=0;
    var promediomasbajo1v=99999999;
    var promediomasalto2v=0;
    var promediomasbajo2v=99999999;

    var totaltodos1t=0;
    var promediotodos1t=0;
    var maximotodos1t=0;
    var minimotodos1t=99999999;
    var totaltodos2t=0;
    var promediotodos2t=0;
    var maximotodos2t=0;
    var minimotodos2t=99999999;
    var promediomasalto1t=0;
    var promediomasbajo1t=99999999;
    var promediomasalto2t=0;
    var promediomasbajo2t=99999999;
    var totalestudiantes=0;
    var promediomaximoejer=0;
    var promediominimoejer=99999999;
    var promediomaximoejer2=0;
    var promediominimoejer2=99999999;
    var promediomaximovid=0;
    var promediominimovid=99999999;
    var promediomaximovid2=0;
    var promediominimovid2=99999999;
    var promediomaximotot=0;
    var promediominimotot=99999999;
    var promediomaximotot2=0;
    var promediominimotot2=99999999;
    for (var i=0;i<clase.length;i++){
      /*categorias[i]=clase[i]["nombre"];
      tpoejercicios1[i]=clase[i]["tiempo_ejercicios_clase_1"];
      tpoejercicios2[i]=clase[i]["tiempo_ejercicios_clase_2"];
      tpovideos1[i]=clase[i]["tiempo_videos_clase_1"];
      tpovideos2[i]=clase[i]["tiempo_videos_clase_2"];
      cantidad1[i]=clase[i]["total_ejercicios_clase_1"];
      cantidad2[i]=clase[i]["total_ejercicios_clase_2"];*/
      var estudiantes = clase[i]["students"];
      var maxtpoejer1=0;
      var maxtpovid1=0;
      var maxtotejer1=0;
      var mintpoejer1=99999999;
      var mintpovid1=99999999;
      var mintotejer1=99999999;
      var estudtrabtpoejer1=0;
      var estudtrabtpovid1=0;
      var estudtrabcantejer1=0;
      var maxtpoejer2=0;
      var maxtpovid2=0;
      var maxtotejer2=0;
      var mintpoejer2=99999999;
      var mintpovid2=99999999;
      var mintotejer2=99999999;
      var estudtrabtpoejer2=0;
      var estudtrabtpovid2=0;
      var estudtrabcantejer2=0;
      totalestudiantes+=estudiantes.length;
      for (j=0;j<estudiantes.length;j++){
        if (estudiantes[j]["total_ejercicios_1"]>maxtotejer1){
          maxtotejer1=estudiantes[j]["total_ejercicios_1"];
        }
        if (estudiantes[j]["tiempo_ejercicios_1"]>maxtpoejer1){
          maxtpoejer1=estudiantes[j]["tiempo_ejercicios_1"];
        }
        if (estudiantes[j]["tiempo_videos_1"]>maxtpovid1){
          maxtpovid1=estudiantes[j]["tiempo_videos_1"];
        }
        if (estudiantes[j]["total_ejercicios_1"]<mintotejer1 && estudiantes[j]["total_ejercicios_1"]!=0){
          mintotejer1=estudiantes[j]["total_ejercicios_1"];
        }
        if (estudiantes[j]["tiempo_ejercicios_1"]<mintpoejer1 && estudiantes[j]["tiempo_ejercicios_1"]!=0){
          mintpoejer1=estudiantes[j]["tiempo_ejercicios_1"];
        }
        if (estudiantes[j]["tiempo_videos_1"]<mintpovid1 && estudiantes[j]["tiempo_videos_1"]!=0){
          mintpovid1=estudiantes[j]["tiempo_videos_1"];
        }
        if (estudiantes[j]["total_ejercicios_1"]>0){
          estudtrabcantejer1++;
        }
        if (estudiantes[j]["tiempo_ejercicios_1"]>0){
          estudtrabtpoejer1++;
        }
        if (estudiantes[j]["tiempo_videos_1"]>0){
          estudtrabtpovid1++;
        }

        if (estudiantes[j]["total_ejercicios_2"]>maxtotejer2){
          maxtotejer2=estudiantes[j]["total_ejercicios_2"];
        }
        if (estudiantes[j]["tiempo_ejercicios_2"]>maxtpoejer2){
          maxtpoejer2=estudiantes[j]["tiempo_ejercicios_2"];
        }
        if (estudiantes[j]["tiempo_videos_2"]>maxtpovid2){
          maxtpovid2=estudiantes[j]["tiempo_videos_2"];
        }
        if (estudiantes[j]["total_ejercicios_2"]<mintotejer2 && estudiantes[j]["total_ejercicios_2"]!=0){
          mintotejer2=estudiantes[j]["total_ejercicios_2"];
        }
        if (estudiantes[j]["tiempo_ejercicios_2"]<mintpoejer2 && estudiantes[j]["tiempo_ejercicios_2"]!=0){
          mintpoejer2=estudiantes[j]["tiempo_ejercicios_2"];
        }
        if (estudiantes[j]["tiempo_videos_2"]<mintpovid1 && estudiantes[j]["tiempo_videos_2"]!=0){
          mintpovid2=estudiantes[j]["tiempo_videos_2"];
        }
        if (estudiantes[j]["total_ejercicios_2"]>0){
          estudtrabcantejer2++;
        }
        if (estudiantes[j]["tiempo_ejercicios_2"]>0){
          estudtrabtpoejer2++;
        }
        if (estudiantes[j]["tiempo_videos_2"]>0){
          estudtrabtpovid2++;
        }
      }
      if (mintpoejer1==99999999){
        mintpoejer1=0
      }
       if (mintpovid1==99999999){
        mintpovid1=0
      }
       if (mintotejer1==99999999){
        mintotejer1=0
      }
      if (mintpoejer2==99999999){
        mintpoejer2=0
      }
       if (mintpovid2==99999999){
        mintpovid2=0
      }
       if (mintotejer2==99999999){
        mintotejer2=0
      }

      totaltodos1+=clase[i]["tiempo_ejercicios_clase_1"];
      //promediotodos1+=clase[i]["tiempo_ejercicios_clase_1"]/estudtrabtpoejer1;
      if (clase[i]["tiempo_ejercicios_clase_1"]>promediomasalto1){
        promediomasalto1=clase[i]["tiempo_ejercicios_clase_1"];
      }
      if (clase[i]["tiempo_ejercicios_clase_1"]<promediomasbajo1){
        promediomasbajo1=clase[i]["tiempo_ejercicios_clase_1"];
      }
      if (maxtpoejer1>maximotodos1){
        maximotodos1=maxtpoejer1;
      }

      if (mintpoejer1<minimotodos1){
        minimotodos1=mintpoejer1;
      }
      if (clase[i]["tiempo_ejercicios_clase_1"]/estudtrabtpoejer1>promediomaximoejer){
        promediomaximoejer=clase[i]["tiempo_ejercicios_clase_1"]/estudtrabtpoejer1;
      }
      if (clase[i]["tiempo_ejercicios_clase_1"]/estudtrabtpoejer1<promediominimoejer){
        promediominimoejer=clase[i]["tiempo_ejercicios_clase_1"]/estudtrabtpoejer1;
      }

      totaltodos2+=clase[i]["tiempo_ejercicios_clase_2"];
      //promediotodos2+=(clase[i]["tiempo_ejercicios_clase_2"]/estudtrabtpoejer2);
      //console.log(promediotodos2);
      if (clase[i]["tiempo_ejercicios_clase_2"]>promediomasalto2){
        promediomasalto2=clase[i]["tiempo_ejercicios_clase_2"];
      }
      if (clase[i]["tiempo_ejercicios_clase_2"]<promediomasbajo2){
        promediomasbajo2=clase[i]["tiempo_ejercicios_clase_2"];
      }
      if (maxtpoejer2>maximotodos2){
        maximotodos2=maxtpoejer2;
      }

      if (mintpoejer2<minimotodos2){
        minimotodos2=mintpoejer2;
      }
      if (clase[i]["tiempo_ejercicios_clase_2"]/estudtrabtpoejer2>promediomaximoejer2){
        promediomaximoejer2=clase[i]["tiempo_ejercicios_clase_2"]/estudtrabtpoejer2;
      }
      if (clase[i]["tiempo_ejercicios_clase_2"]/estudtrabtpoejer2<promediominimoejer2){
        promediominimoejer2=clase[i]["tiempo_ejercicios_clase_2"]/estudtrabtpoejer2;
      }


      totaltodos1v+=clase[i]["tiempo_videos_clase_1"];
      //promediotodos1v+=clase[i]["tiempo_videos_clase_1"]/estudtrabtpovid1;
      if (clase[i]["tiempo_videos_clase_1"]>promediomasalto1v){
        promediomasalto1v=clase[i]["tiempo_videos_clase_1"];
      }
      if (clase[i]["tiempo_videos_clase_1"]<promediomasbajo1v){
        promediomasbajo1v=clase[i]["tiempo_videos_clase_1"];
      }
      if (maxtpovid1>maximotodos1v){
        maximotodos1v=maxtpovid1;
      }

      if (mintpovid1<minimotodos1v){
        minimotodos1v=mintpovid1;
      }
      if(clase[i]["tiempo_videos_clase_1"]/estudtrabtpovid1>promediomaximovid){
        promediomaximovid=clase[i]["tiempo_videos_clase_1"]/estudtrabtpovid1;
      }
      if(clase[i]["tiempo_videos_clase_1"]/estudtrabtpovid1<promediominimovid){
        promediominimovid=clase[i]["tiempo_videos_clase_1"]/estudtrabtpovid1;
      }

      totaltodos2v+=clase[i]["tiempo_videos_clase_2"];
      //promediotodos2v+=(clase[i]["tiempo_videos_clase_2"]/estudtrabtpovid2);
      if (clase[i]["tiempo_videos_clase_2"]>promediomasalto2v){
        promediomasalto2v=clase[i]["tiempo_videos_clase_2"];
      }
      if (clase[i]["tiempo_videos_clase_2"]<promediomasbajo2v){
        promediomasbajo2v=clase[i]["tiempo_videos_clase_2"];
      }
      if (maxtpovid2>maximotodos2v){
        maximotodos2v=maxtpovid2;
      }

      if (mintpovid2<minimotodos2v){
        minimotodos2v=mintpovid2;
      }
      if(clase[i]["tiempo_videos_clase_2"]/estudtrabtpovid2>promediomaximovid2){
        promediomaximovid2=clase[i]["tiempo_videos_clase_2"]/estudtrabtpovid2;
      }
      if(clase[i]["tiempo_videos_clase_2"]/estudtrabtpovid2<promediominimovid2){
        promediominimovid2=clase[i]["tiempo_videos_clase_2"]/estudtrabtpovid2;
      }


      totaltodos1t+=clase[i]["total_ejercicios_clase_1"];
      //promediotodos1t+=clase[i]["total_ejercicios_clase_1"]/estudtrabcantejer1;
      if (clase[i]["total_ejercicios_clase_1"]>promediomasalto1t){
        promediomasalto1t=clase[i]["total_ejercicios_clase_1"];
      }
      if (clase[i]["total_ejercicios_clase_1"]<promediomasbajo1t){
        promediomasbajo1t=clase[i]["total_ejercicios_clase_1"];
      }
      if (maxtotejer1>maximotodos1t){
        maximotodos1t=maxtotejer1;
      }

      if (mintotejer1<minimotodos1t){
        minimotodos1t=mintotejer1;
      }
      if(clase[i]["total_ejercicios_clase_1"]/estudtrabcantejer1>promediomaximotot){
        promediomaximotot=clase[i]["total_ejercicios_clase_1"]/estudtrabcantejer1;
      }
      if(clase[i]["total_ejercicios_clase_1"]/estudtrabcantejer1<promediominimotot){
        promediominimotot=clase[i]["total_ejercicios_clase_1"]/estudtrabcantejer1;
      }

      totaltodos2t+=clase[i]["total_ejercicios_clase_2"];
      //promediotodos2t+=(clase[i]["total_ejercicios_clase_2"]/estudtrabcantejer2);
      if (clase[i]["total_ejercicios_clase_2"]>promediomasalto2t){
        promediomasalto2t=clase[i]["total_ejercicios_clase_2"];
      }
      if (clase[i]["total_ejercicios_clase_2"]<promediomasbajo2t){
        promediomasbajo2t=clase[i]["total_ejercicios_clase_2"];
      }
      if (maxtotejer2>maximotodos2t){
        maximotodos2t=maxtotejer2;
      }

      if (mintotejer2<minimotodos2t){
        minimotodos2t=mintotejer2;
      }
      if(clase[i]["total_ejercicios_clase_2"]/estudtrabcantejer2>promediomaximotot2){
        promediomaximotot2=clase[i]["total_ejercicios_clase_2"]/estudtrabcantejer2;
      }
      if(clase[i]["total_ejercicios_clase_2"]/estudtrabcantejer2<promediominimotot2){
        promediominimotot2=clase[i]["total_ejercicios_clase_2"]/estudtrabcantejer2;
      }

      categorias[i]=clase[i]["nombre"]+' '+clase[i]["establecimiento"];
      //tpoejercicios1[i]=clase[i]["tiempo_ejercicios_clase_1"];
      tpoejercicios1[i]={"name":clase[i]["nombre"]+' '+clase[i]["establecimiento"], "y":clase[i]["tiempo_ejercicios_clase_1"], "cantidad":estudiantes.length, "trabajaron":estudtrabtpoejer1, "maximo":maxtpoejer1, "minimo":mintpoejer1, "promedio":clase[i]["tiempo_ejercicios_clase_1"]/estudtrabtpoejer1};
      //tpoejercicios2[i]=clase[i]["tiempo_ejercicios_clase_2"];
      tpoejercicios2[i]={"name":clase[i]["nombre"]+' '+clase[i]["establecimiento"],"y":clase[i]["tiempo_ejercicios_clase_2"], "cantidad":estudiantes.length, "trabajaron":estudtrabtpoejer2, "maximo":maxtpoejer2, "minimo":mintpoejer2, "promedio":clase[i]["tiempo_ejercicios_clase_2"]/estudtrabtpoejer2};
      //tpovideos1[i]=clase[i]["tiempo_videos_clase_1"];
      tpovideos1[i]={"name":clase[i]["nombre"]+' '+clase[i]["establecimiento"],"y":clase[i]["tiempo_videos_clase_1"], "cantidad":estudiantes.length, "trabajaron":estudtrabtpovid1, "maximo":maxtpovid1, "minimo":mintpovid1, "promedio":clase[i]["tiempo_videos_clase_1"]/estudtrabtpovid1}
      //tpovideos2[i]=clase[i]["tiempo_videos_clase_2"];
      tpovideos2[i]={"name":clase[i]["nombre"]+' '+clase[i]["establecimiento"],"y":clase[i]["tiempo_videos_clase_2"], "cantidad":estudiantes.length, "trabajaron":estudtrabtpovid2, "maximo":maxtpovid2, "minimo":mintpovid2, "promedio":clase[i]["tiempo_videos_clase_2"]/estudtrabtpovid2}
      //cantidad1[i]=clase[i]["total_ejercicios_clase_1"];
      cantidad1[i]={"name":clase[i]["nombre"]+' '+clase[i]["establecimiento"],"y":clase[i]["total_ejercicios_clase_1"], "cantidad":estudiantes.length, "trabajaron":estudtrabcantejer1, "maximo":maxtotejer1, "minimo":mintotejer1, "promedio":clase[i]["total_ejercicios_clase_1"]/estudtrabcantejer1}
      //cantidad2[i]=clase[i]["total_ejercicios_clase_2"];
      cantidad2[i]={"name":clase[i]["nombre"]+' '+clase[i]["establecimiento"],"y":clase[i]["total_ejercicios_clase_2"], "cantidad":estudiantes.length, "trabajaron":estudtrabcantejer2, "maximo":maxtotejer2, "minimo":mintotejer2, "promedio":clase[i]["total_ejercicios_clase_2"]/estudtrabcantejer2}
    }
    //promediotodos1=promediotodos1/clase.length;
    promediotodos2=totaltodos2/totalestudiantes;
    promediotodos1=totaltodos1/totalestudiantes;

    var promediotod='';
    promediotod+='<div>Total '+tipo1+': '+totaltodos1.toLocaleString()+' segundos<br>';
    promediotod+='Promedio '+tipo1+': '+promediotodos1.toLocaleString()+' segundos<br>';
    promediotod+='Promedio Máximo '+tipo1+': '+promediomaximoejer.toLocaleString()+' segundos<br>';
    promediotod+='Promedio Mínimo '+tipo1+': '+promediominimoejer.toLocaleString()+' segundos<br>';
    promediotod+='Curso Máximo '+tipo1+': '+promediomasalto1.toLocaleString()+' segundos<br>';
    promediotod+='Curso Mínimo '+tipo1+': '+promediomasbajo1.toLocaleString()+' segundos<br>';
    promediotod+='Estudiante Máximo '+tipo1+': '+maximotodos1.toLocaleString()+' segundos<br>';
    promediotod+='Estudiante Mínimo '+tipo1+': '+minimotodos1.toLocaleString()+' segundos</div>';

    $('#promediototalej').append(promediotod);

    var promediotod2='';
    promediotod2+='<div>Total '+tipo2+': '+totaltodos2.toLocaleString()+' segundos<br>';
    promediotod2+='Promedio '+tipo2+': '+promediotodos2.toLocaleString()+' segundos<br>';
    promediotod2+='Promedio Máximo '+tipo2+': '+promediomaximoejer2.toLocaleString()+' segundos<br>';
    promediotod2+='Promedio Mínimo '+tipo2+': '+promediominimoejer2.toLocaleString()+' segundos<br>';
    promediotod2+='Curso Máximo '+tipo2+': '+promediomasalto2.toLocaleString()+' segundos<br>';
    promediotod2+='Curso Mínimo '+tipo2+': '+promediomasbajo2.toLocaleString()+' segundos<br>';
    promediotod2+='Estudiante Máximo '+tipo2+': '+maximotodos2.toLocaleString()+' segundos<br>';
    promediotod2+='Estudiante Mínimo '+tipo2+': '+minimotodos2.toLocaleString()+' segundos</div>';

    $('#promediototalej2').append(promediotod2);


    promediotodos1v=totaltodos1v/totalestudiantes;
    promediotodos2v=totaltodos2v/totalestudiantes;

    var promediotodv='';
    promediotodv+='<div>Total '+tipo1+': '+totaltodos1v.toLocaleString()+' segundos<br>';
    promediotodv+='Promedio '+tipo1+': '+promediotodos1v.toLocaleString()+' segundos<br>';
    promediotodv+='Promedio Máximo '+tipo1+': '+promediomaximovid.toLocaleString()+' segundos<br>';
    promediotodv+='Promedio Mínimo '+tipo1+': '+promediominimovid.toLocaleString()+' segundos<br>';
    promediotodv+='Curso Máximo '+tipo1+': '+promediomasalto1v.toLocaleString()+' segundos<br>';
    promediotodv+='Curso Mínimo '+tipo1+': '+promediomasbajo1v.toLocaleString()+' segundos<br>';
    promediotodv+='Estudiante Máximo '+tipo1+': '+maximotodos1v.toLocaleString()+' segundos<br>';
    promediotodv+='Estudiante Mínimo '+tipo1+': '+minimotodos1v.toLocaleString()+' segundos</div>';

    $('#promediototalvid').append(promediotodv);

    var promediotod2v='';
    promediotod2v+='<div>Total '+tipo2+': '+totaltodos2v.toLocaleString()+' segundos<br>';
    promediotod2v+='Promedio '+tipo2+': '+promediotodos2v.toLocaleString()+' segundos<br>';
    promediotod2v+='Promedio Máximo '+tipo2+': '+promediomaximovid2.toLocaleString()+' segundos<br>';
    promediotod2v+='Promedio Mínimo '+tipo2+': '+promediominimovid2.toLocaleString()+' segundos<br>';
    promediotod2v+='Curso Máximo '+tipo2+': '+promediomasalto2v.toLocaleString()+' segundos<br>';
    promediotod2v+='Curso Mínimo '+tipo2+': '+promediomasbajo2v.toLocaleString()+' segundos<br>';
    promediotod2v+='Estudiante Máximo '+tipo2+': '+maximotodos2v.toLocaleString()+' segundos<br>';
    promediotod2v+='Estudiante Mínimo '+tipo2+': '+minimotodos2v.toLocaleString()+' segundos</div>';

    $('#promediototalvid2').append(promediotod2v);


    promediotodos1t=totaltodos1t/totalestudiantes;
    promediotodos2t=totaltodos2t/totalestudiantes;

    var promediotodt='';
    promediotodt+='<div>Total '+tipo1+': '+totaltodos1t.toLocaleString()+' ejercicios<br>';
    promediotodt+='Promedio '+tipo1+': '+promediotodos1t.toLocaleString()+' ejercicios<br>';
    promediotodt+='Promedio Máximo '+tipo1+': '+promediomaximotot.toLocaleString()+' ejercicios<br>';
    promediotodt+='Promedio Mínimo '+tipo1+': '+promediominimotot.toLocaleString()+' ejercicios<br>';
    promediotodt+='Curso Máximo '+tipo1+': '+promediomasalto1t.toLocaleString()+' ejercicios<br>';
    promediotodt+='Curso Mínimo '+tipo1+': '+promediomasbajo1t.toLocaleString()+' ejercicios<br>';
    promediotodt+='Estudiante Máximo '+tipo1+': '+maximotodos1t.toLocaleString()+' ejercicios<br>';
    promediotodt+='Estudiante Mínimo '+tipo1+': '+minimotodos1t.toLocaleString()+' ejercicios</div>';

    $('#promediototaltot').append(promediotodt);

    var promediotod2t='';
    promediotod2t+='<div>Total '+tipo2+': '+totaltodos2t.toLocaleString()+' ejercicios<br>';
    promediotod2t+='Promedio '+tipo2+': '+promediotodos2t.toLocaleString()+' ejercicios<br>';
    promediotod2t+='Promedio Máximo '+tipo2+': '+promediomaximotot2.toLocaleString()+' ejercicios<br>';
    promediotod2t+='Promedio Mínimo '+tipo2+': '+promediominimotot2.toLocaleString()+' ejercicios<br>';
    promediotod2t+='Curso Máximo '+tipo2+': '+promediomasalto2t.toLocaleString()+' ejercicios<br>';
    promediotod2t+='Curso Mínimo '+tipo2+': '+promediomasbajo2t.toLocaleString()+' ejercicios<br>';
    promediotod2t+='Estudiante Máximo '+tipo2+': '+maximotodos2t.toLocaleString()+' ejercicios<br>';
    promediotod2t+='Estudiante Mínimo '+tipo2+': '+minimotodos2t.toLocaleString()+' ejercicios</div>';

    $('#promediototaltot2').append(promediotod2t);

  }

  else{
    if(json["students"]){
      var student = json["students"]
      var tipo1 = student[0]["tipo1"]
      var tipo2 = student[0]["tipo2"]
      for (j=0;j<student.length;j++){
        categorias[j]=student[j]["name"];
        tpoejercicios1[j] = student[j]["tiempo_ejercicios_1"]
        tpoejercicios2[j] = student[j]["tiempo_ejercicios_2"]
        tpovideos1[j] = student[j]["tiempo_videos_1"]
        tpovideos2[j] = student[j]["tiempo_videos_2"]
        cantidad1[j] = student[j]["total_ejercicios_1"]
        cantidad2[j] = student[j]["total_ejercicios_2"]

      }
    }
  }

  $(function () {
      Highcharts.setOptions({
          lang:{
          decimalPoint: ",",
          thousandsSep: ".",
          downloadJPEG: "Descargar imagen JPEG",
          downloadPDF: "Descargar documento PDF",
          downloadPNG: "Descargar imagen PNG",
          downloadSVG: "Descargar imagen vectorial SVG",
          printChart: "Imprimir gráfico",
          drillUpText: "Volver a {series.name}" 
        }
      });
    var chart = new Highcharts.Chart({
        chart: {
            renderTo: 'containerej',
            type: 'column',
        },
        title: {
            text: 'Tiempo de ejercicios'
        },
        subtitle: {
            text: 'Fuente: <a href="https://es.khanacademy.org/">Khan Academy</a>'
        },
        xAxis: {
            categories: categorias,
            crosshair: true
        },
        yAxis: {
            min: 0,
            title: {
                text: 'Tiempo (segundos)'
            }
        },
        legend: {
            enabled: true
        },
        tooltip: {
            headerFormat: '<span style="font-size:10px">{point.key}</span><br>',
            pointFormat: '<span style="color:{series.color};padding:0">{series.name}: </span>' +
                '<span style="padding:0"><b>{point.y:,.0f} segundos</b></span><br>'+
                '<span style="color:{series.color};padding:0">Promedio: </span>'+
                '<span style="padding:0"><b>{point.promedio:,.0f} segundos</b></span><br>'+
                '<span style="color:{series.color};padding:0">Máximo: </span>'+
                '<span style="padding:0"><b>{point.maximo:,.0f} segundos</b></span><br>'+
                '<span style="color:{series.color};padding:0">Mínimo: </span>'+
                '<span style="padding:0"><b>{point.minimo:,.0f} segundos</b></span><br>'+
                '<span style="color:{series.color};padding:0">Total de estudiantes: </span>'+
                '<span style="padding:0"><b>{point.cantidad} estudiantes</b></span><br>'+
                '<span style="color:{series.color};padding:0">Est. que trabajaron: </span>'+
                '<span style="padding:0"><b>{point.trabajaron} estudiantes</b></span><br>',
            //footerFormat: '<br>',
            shared: true,
            useHTML: true
        },
        plotOptions: {
            column: {
                pointPadding: 0.2,
                borderWidth: 0
            }
        },
        series: [{
            name: tipo1,
            data: tpoejercicios1,
            dataLabels: {
                enabled: true,
                rotation: -90,
                color: 'KhanBlue',
                align: 'right',
                format: '{point.y:,.0f}', // one decimal
                y: 10, // 10 pixels down from the top
                style: {
                    fontSize: '11px',
                    fontFamily: 'Verdana, sans-serif'
                }
            }
            },{
            name: tipo2,
            data: tpoejercicios2,
            dataLabels: {
                enabled: true,
                rotation: -90,
                color: 'KhanBlue',
                align: 'right',
                format: '{point.y:,.0f}', // one decimal
                y: 10, // 10 pixels down from the top
                style: {
                    fontSize: '11px',
                    fontFamily: 'Verdana, sans-serif'
                }
            }
        }]
    });
    function sortTotal(valor){
      //aqui va algo
      if (valor=="0"){
        tpoejercicios1.sort(function(a,b){
          return ((a.name < b.name) ? -1 : ((a.name > b.name) ? 1 : 0));
        });
        /*categorias.sort(function(a,b){
          return ((a < b) ? -1 : ((a > b) ? 1 : 0));
        });*/
        categorias.sort();
        //categorias.reverse();
      }
      if (valor=="1"){
        tpoejercicios1.sort(function(a,b){
          return parseInt(a.y) - parseInt(b.y);
        });
      }
      if (valor=="2"){
        tpoejercicios1.sort(function(a,b){
          return parseInt(b.y) - parseInt(a.y);
        });
      }
      if (valor=="3"){
        tpoejercicios1.sort(function(a,b){
          return parseInt(a.promedio) - parseInt(b.promedio);
        });
      }
      if (valor=="4"){
        tpoejercicios1.sort(function(a,b){
          return parseInt(b.promedio) - parseInt(a.promedio);
        });
      }
      if (valor=="5"){
        tpoejercicios1.sort(function(a,b){
          return parseInt(a.maximo) - parseInt(b.maximo);
        });
      }
      if (valor=="6"){
        tpoejercicios1.sort(function(a,b){
          return parseInt(b.maximo) - parseInt(a.maximo);
        });
      }
      if (valor=="7"){
        tpoejercicios1.sort(function(a,b){
          return parseInt(a.minimo) - parseInt(b.minimo);
        });
      }
      if (valor=="8"){
        tpoejercicios1.sort(function(a,b){
          return parseInt(b.minimo) - parseInt(a.minimo);
        });
      }
      for (var i = 0; i < tpoejercicios1.length; i++) {
        categorias[i]=tpoejercicios1[i]['name']
      }
      return [tpoejercicios1, categorias];
    }

    $('#ordenartot').change(function(){
      var retorno = sortTotal($('select#ordenartot option:selected').val());
      chart.series[0].update(retorno);
    })
  });
    $(function () {
      Highcharts.setOptions({
          lang:{
          decimalPoint: ",",
          thousandsSep: ".",
          downloadJPEG: "Descargar imagen JPEG",
          downloadPDF: "Descargar documento PDF",
          downloadPNG: "Descargar imagen PNG",
          downloadSVG: "Descargar imagen vectorial SVG",
          printChart: "Imprimir gráfico",
          drillUpText: "Volver a {series.name}" 
        }
      });
      var chart = new Highcharts.Chart({
        chart: {
            renderTo: 'containervid',
            type: 'column',
        },
        title: {
            text: 'Tiempo de videos'
        },
        subtitle: {
            text: 'Fuente: <a href="https://es.khanacademy.org/">Khan Academy</a>'
        },
        xAxis: {
            categories: categorias,
            crosshair: true
        },
        yAxis: {
            min: 0,
            title: {
                text: 'Tiempo (segundos)'
            }
        },
        legend: {
            enabled: true
        },
        tooltip: {
            headerFormat: '<span style="font-size:10px">{point.key}</span><br>',
            pointFormat: '<span style="color:{series.color};padding:0">{series.name}: </span>' +
                '<span style="padding:0"><b>{point.y:,.0f} segundos</b></span><br>'+
                '<span style="color:{series.color};padding:0">Promedio: </span>'+
                '<span style="padding:0"><b>{point.promedio:,.0f} segundos</b></span><br>'+
                '<span style="color:{series.color};padding:0">Máximo: </span>'+
                '<span style="padding:0"><b>{point.maximo:,.0f} segundos</b></span><br>'+
                '<span style="color:{series.color};padding:0">Mínimo: </span>'+
                '<span style="padding:0"><b>{point.minimo:,.0f} segundos</b></span><br>'+
                '<span style="color:{series.color};padding:0">Total de estudiantes: </span>'+
                '<span style="padding:0"><b>{point.cantidad} estudiantes</b></span><br>'+
                '<span style="color:{series.color};padding:0">Est. que trabajaron: </span>'+
                '<span style="padding:0"><b>{point.trabajaron} estudiantes</b></span><br>',
            //footerFormat: '</table>',
            shared: true,
            useHTML: true
        },
        plotOptions: {
            column: {
                pointPadding: 0.2,
                borderWidth: 0
            }
        },
        series: [{
            name: tipo1,
            data: tpovideos1,
            dataLabels: {
                enabled: true,
                rotation: -90,
                color: 'KhanBlue',
                align: 'right',
                format: '{point.y:,.0f}', // one decimal
                y: 10, // 10 pixels down from the top
                style: {
                    fontSize: '11px',
                    fontFamily: 'Verdana, sans-serif'
                }
            }
            },{
            name: tipo2,
            data: tpovideos2,
            dataLabels: {
                enabled: true,
                rotation: -90,
                color: 'KhanBlue',
                align: 'right',
                format: '{point.y:,.0f}', // one decimal
                y: 10, // 10 pixels down from the top
                style: {
                    fontSize: '11px',
                    fontFamily: 'Verdana, sans-serif'
                }
            }
        }]
    });
    function sortTotal(valor){
      //aqui va algo
      if (valor=="0"){
        tpovideos1.sort(function(a,b){
          return ((a.name < b.name) ? -1 : ((a.name > b.name) ? 1 : 0));
        });
        /*categorias.sort(function(a,b){
          return ((a < b) ? -1 : ((a > b) ? 1 : 0));
        });*/
        categorias.sort();
        //categorias.reverse();
      }
      if (valor=="1"){
        tpovideos1.sort(function(a,b){
          return parseInt(a.y) - parseInt(b.y);
        });
      }
      if (valor=="2"){
        tpovideos1.sort(function(a,b){
          return parseInt(b.y) - parseInt(a.y);
        });
      }
      if (valor=="3"){
        tpovideos1.sort(function(a,b){
          return parseInt(a.promedio) - parseInt(b.promedio);
        });
      }
      if (valor=="4"){
        tpovideos1.sort(function(a,b){
          return parseInt(b.promedio) - parseInt(a.promedio);
        });
      }
      if (valor=="5"){
        tpovideos1.sort(function(a,b){
          return parseInt(a.maximo) - parseInt(b.maximo);
        });
      }
      if (valor=="6"){
        tpovideos1.sort(function(a,b){
          return parseInt(b.maximo) - parseInt(a.maximo);
        });
      }
      if (valor=="7"){
        tpovideos1.sort(function(a,b){
          return parseInt(a.minimo) - parseInt(b.minimo);
        });
      }
      if (valor=="8"){
        tpovideos1.sort(function(a,b){
          return parseInt(b.minimo) - parseInt(a.minimo);
        });
      }
      for (var i = 0; i < tpovideos1.length; i++) {
        categorias[i]=tpovideos1[i]['name']
      }
      return [tpovideos1, categorias];
    }

    $('#ordenarvid').change(function(){
      var retorno = sortTotal($('select#ordenarvid option:selected').val());
      chart.series[0].update(retorno);
    })
  });
    $(function () {
      Highcharts.setOptions({
          lang:{
          decimalPoint: ",",
          thousandsSep: ".",
          downloadJPEG: "Descargar imagen JPEG",
          downloadPDF: "Descargar documento PDF",
          downloadPNG: "Descargar imagen PNG",
          downloadSVG: "Descargar imagen vectorial SVG",
          printChart: "Imprimir gráfico",
          drillUpText: "Volver a {series.name}" 
        }
      });
    var chart = new Highcharts.Chart({
        chart: {
            renderTo: 'containertot',
            type: 'column',
        },
        title: {
            text: 'Cantidad de ejercicios'
        },
        subtitle: {
            text: 'Fuente: <a href="https://es.khanacademy.org/">Khan Academy</a>'
        },
        xAxis: {
            categories: categorias,
            crosshair: true
        },
        yAxis: {
            min: 0,
            title: {
                text: 'Cantidad (ejercicios)'
            }
        },
        legend: {
            enabled: true
        },
        tooltip: {
            headerFormat: '<span style="font-size:10px">{point.key}</span><br>',
            pointFormat: '<span style="color:{series.color};padding:0">{series.name}: </span>' +
                '<span style="padding:0"><b>{point.y:,.0f} ejercicios</b></span><br>'+
                '<span style="color:{series.color};padding:0">Promedio: </span>'+
                '<span style="padding:0"><b>{point.promedio:,.0f} ejercicios</b></span><br>'+
                '<span style="color:{series.color};padding:0">Máximo: </span>'+
                '<span style="padding:0"><b>{point.maximo:,.0f} ejercicios</b></span><br>'+
                '<span style="color:{series.color};padding:0">Mínimo: </span>'+
                '<span style="padding:0"><b>{point.minimo:,.0f} ejercicios</b></span><br>'+
                '<span style="color:{series.color};padding:0">Total de estudiantes: </span>'+
                '<span style="padding:0"><b>{point.cantidad} estudiantes</b></span><br>'+
                '<span style="color:{series.color};padding:0">Est. que trabajaron: </span>'+
                '<span style="padding:0"><b>{point.trabajaron} estudiantes</b></span><br>',
            //footerFormat: '</table>',
            shared: true,
            useHTML: true
        },
        plotOptions: {
            column: {
                pointPadding: 0.2,
                borderWidth: 0
            }
        },
        series: [{
            name: tipo1,
            data: cantidad1,
            dataLabels: {
                enabled: true,
                rotation: -90,
                color: 'KhanBlue',
                align: 'right',
                format: '{point.y:,.0f}', // one decimal
                y: 10, // 10 pixels down from the top
                style: {
                    fontSize: '11px',
                    fontFamily: 'Verdana, sans-serif'
                }
            }
            },{
            name: tipo2,
            data: cantidad2,
            dataLabels: {
                enabled: true,
                rotation: -90,
                color: 'KhanBlue',
                align: 'right',
                format: '{point.y:,.0f}', // one decimal
                y: 10, // 10 pixels down from the top
                style: {
                    fontSize: '11px',
                    fontFamily: 'Verdana, sans-serif'
                }
            }
        }]
    });
    function sortTotal(valor){
      //aqui va algo
      if (valor=="0"){
        cantidad1.sort(function(a,b){
          return ((a.name < b.name) ? -1 : ((a.name > b.name) ? 1 : 0));
        });
        /*categorias.sort(function(a,b){
          return ((a < b) ? -1 : ((a > b) ? 1 : 0));
        });*/
        categorias.sort();
        //categorias.reverse();
      }
      if (valor=="1"){
        cantidad1.sort(function(a,b){
          return parseInt(a.y) - parseInt(b.y);
        });
      }
      if (valor=="2"){
        cantidad1.sort(function(a,b){
          return parseInt(b.y) - parseInt(a.y);
        });
      }
      if (valor=="3"){
        cantidad1.sort(function(a,b){
          return parseInt(a.promedio) - parseInt(b.promedio);
        });
      }
      if (valor=="4"){
        cantidad1.sort(function(a,b){
          return parseInt(b.promedio) - parseInt(a.promedio);
        });
      }
      if (valor=="5"){
        cantidad1.sort(function(a,b){
          return parseInt(a.maximo) - parseInt(b.maximo);
        });
      }
      if (valor=="6"){
        cantidad1.sort(function(a,b){
          return parseInt(b.maximo) - parseInt(a.maximo);
        });
      }
      if (valor=="7"){
        cantidad1.sort(function(a,b){
          return parseInt(a.minimo) - parseInt(b.minimo);
        });
      }
      if (valor=="8"){
        cantidad1.sort(function(a,b){
          return parseInt(b.minimo) - parseInt(a.minimo);
        });
      }
      for (var i = 0; i < cantidad1.length; i++) {
        categorias[i]=cantidad1[i]['name']
      }
      return [cantidad1, categorias];
    }

    $('#ordenarcant').change(function(){
      var retorno = sortTotal($('select#ordenarcant option:selected').val());
      chart.series[0].update(retorno);
    })
  });
}

function validar(){
  var today = new Date();
  var dd = today.getDate();
  var mm = today.getMonth()+1; //January is 0!
  var yyyy = today.getFullYear();

  if(dd<10) {
      dd='0'+dd
  } 

  if(mm<10) {
      mm='0'+mm
  } 

  today = yyyy+'-'+mm+'-'+dd;
  flag = true;
  desde = document.getElementById("desde").value;
  hasta = document.getElementById("hasta").value;
  if(desde == null || desde.length == 0 || /^\s+$/.test(desde)) {
    $('#desde').css('color', '#C30202');
    flag = false;
  }else{
    $('#desde').css('color', '#000000');
  }
  //if(date_end == null || startDate > endDate || endDate < todayDate || date_end.length == 0 || /^\s+$/.test(date_end)) {
  if(hasta == null || desde > hasta || hasta.length == 0 || /^\s+$/.test(hasta)) {
    $('#hasta').css('color', '#C30202');
    flag = false;
  }else{
    $('#hasta').css('color', '#000000');
  }
  if(hasta>today){
    $('#hasta').css('color', '#C30202');
    flag = false;
  }
  return flag
}

function updateSchedule(){
  var sel = $('input[name="clase"]:checked').map(function(_,el){
    return $(el).val();
  }).get();
  //var valor = $('input[value*="radio"]:checked').val()
  
  if ($("input[value*='radio']:checked").val()=="radio2"){
    $('#testsched').hide();
    $('input[name="day"]').prop("checked", false);
  }
  else{
    $('#testsched').hide();
    if ($("input[value*='radio']:checked").val()=="radio3"){
      $('input[name="day"]').prop("checked", true);
    }
  }
}

function selectSchedule(radiobutton){
  $('input[name="day"]').prop("checked", false);
  var valor = radiobutton.value;
  if (valor=="radio1" || valor=="radio5" || valor=="radio6" || valor=="radio7"){
    $('#testsched').hide();
  }
  if (valor=="radio2"){
    $('#testsched').hide();
    var selcurso=[];
    var curso = $("#contenedor").jstree("get_selected");
    //selcurso = (curso.indexOf("id_")>-1);
    for (var i=0;i<curso.length;i++){
      if (curso[i].indexOf("id_")==false){
        selcurso.push(curso[i]);
      }
    }
    if (selcurso.length===0){
      $('#popup').empty();
      $('#popup').append("<p>No existe ningún curso seleccionado</p>")
      $('#popup').fadeIn().css('display', '');
      $("#hover").fadeIn().css('display', '');
    }
    
  }
  if (valor=="radio3"){
    $('#testsched').hide();
    //$('input[name="day"]').prop("disabled", true);
    $('#popup').empty();
    var selcurso=[];
    var curso = $("#contenedor").jstree("get_selected");
    //selcurso = (curso.indexOf("id_")>-1);
    for (var i=0;i<curso.length;i++){
      if (curso[i].indexOf("id_")==false){
        selcurso.push(curso[i]);
      }
    }
    if (selcurso.length===0){
      $('#popup').empty();
      $('#popup').append("<p>No existe ningún curso seleccionado</p>")
      $('#popup').fadeIn().css('display', '');
      $("#hover").fadeIn().css('display', '');

    }
  }
  if (valor=="radio4"){
    //console.log("algoaca");
    drawTableSchedule();
    $('#testsched').show();
   // $('input[name="day"]').prop("disabled", false); 
  }
  //setHeightContent();
}

function funciondos(id_schedule){
  var valor = $('input[value*="radio"]:checked').val()
  if (valor=="radio1" || valor=="radio2" || valor=="radio3" || valor==null || valor=="radio5" || valor=="radio6" || valor=="radio7"){
    $('#testsched').hide();
    //$('input[name="day"]').prop("disabled", true);
    return false;
  }
  else{  
    //drawTableSchedule();
    if(id_schedule<10){
      $('input[value*="0'+id_schedule+'_"]').prop("checked", !$('input[value*="'+id_schedule+'_"]').prop("checked"));
    }
    else{
      $('input[value*="'+id_schedule+'_"]').prop("checked", !$('input[value*="'+id_schedule+'_"]').prop("checked"));
    }
    
    $('input[value="radio4"]').prop("checked", true);
    if($('input[value="radio1"]').checked  || $('input[value="radio2"]').checked || $('input[value="radio3"]').checked){
      $('#testsched').hide();
      $('input[value="radio4"]').prop("checked", false);
    }
  }
}

function diaselect(dia){
  var valor = $('input[value*="radio"]:checked').val()
  $('table#sort_table').tablesorter({
    animation: 'slide',
    speed: 1200,
    sortList: [[0,0]]
  });
  if (valor=="radio1" || valor=="radio2" || valor=="radio3" || valor==null || valor=="radio5" || valor=="radio6" || valor=="radio7"){
    $('#testsched').hide();
    //$('input[name="day"]').prop("disabled", true);
    return false;
  }
  else{
    //drawTableSchedule();
    $('input[value*="'+dia+'"]').prop("checked", !$('input[value*="'+dia+'"]').prop("checked"));
    $('input[value="radio4"]').prop("checked", true);
    if($('input[value="radio1"]').checked  || $('input[value="radio2"]').checked || $('input[value="radio3"]').checked){
      $('#testsched').hide();
      $('input[value="radio4"]').prop("checked", false);
    }
  }

}

</script>

{% endblock %}