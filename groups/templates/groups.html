{% extends 'home.html' %}
{% load static %}
{% load  smart_if %}

{% block title %}
Grupos
{% endblock %}

{% block body2 %}
<head>
<script src="{% static 'd3-timeline.js' %}"></script>
<script>
cont=0;
       function start(e) {
           e.dataTransfer.effecAllowed = 'move'; // Define el efecto como mover (Es el por defecto)
           e.dataTransfer.setData("Data", e.target.id); // Coje el elemento que se va a mover
           e.dataTransfer.setDragImage(e.target, 70, 2.5); // Define la imagen que se vera al ser arrastrado el elemento y por donde se coje el elemento que se va a mover (el raton aparece en la esquina sup_izq con 0,0)
           e.target.style.opacity = '0.4'; 
       };
       function end(e){
           e.target.style.opacity = ''; // Pone la opacidad del elemento a 1           
           e.dataTransfer.clearData("Data");
       };
function over(e) {
   
var elemArrastrable = e.dataTransfer.getData("Data"); // Elemento arrastrado
   var id = e.target.id; // Elemento sobre el que se arrastra       
// return false para que se pueda soltar
if (id == 'Reforzamiento'){
return false; // Cualquier elemento se puede soltar sobre el div destino 1
}
if (id == 'Intermedios'){
return false; 
}   
if (id == 'Avanzados'){
return false;
}
         
if (id == 'SinGrupo'){
return false;
}
if (id.substring(0,21) == 'SubGrupoReforzamiento'){
   
return false;
   }
   if (id.substring(0,19) == 'SubGrupoIntermedios'){
   
return false;
   }
   if (id.substring(0,17) == 'SubGrupoAvanzados'){
   
return false;
   }
};
function fillComboBox(){
//rellenamos los comboBox con tutores dependiendo de el grupo en el que esten
$('select').empty();
$(".comboBoxAvanzados").append("<OPTION VALUE=1>Seleccionar Tutor</OPTION>");
$(".comboBoxIntermedios").append("<OPTION VALUE=2>Seleccionar Tutor</OPTION>");
$(".comboBoxReforzamiento").append("<OPTION VALUE=3>Seleccionar Tutor</OPTION>");
$(".comboBoxAvanzados").append("<OPTION VALUE=1>{{ request.user.username }}</OPTION>");
$(".comboBoxIntermedios").append("<OPTION VALUE=2>{{ request.user.username }}</OPTION>");
$(".comboBoxReforzamiento").append("<OPTION VALUE=3>{{ request.user.username }}</OPTION>");
var divs = document.querySelectorAll('.cuadradito');
   for (var i = 0; i < divs.length; i++) {
       var id1 = divs[i].getAttribute('id');
       var id2 = divs[i].getAttribute('title');
    
var id3 = divs[i].getAttribute('name');
       

if(id3=="Avanzados" || id3.substring(0,17) =="SubGrupoAvanzados"){
       
$(".comboBoxIntermedios").each(function() {
   $(this).append("<OPTION VALUE="+id1+">"+id2+"</OPTION>");
});
       
       
$(".comboBoxReforzamiento").each(function() {
   $(this).append("<OPTION VALUE="+id1+">"+id2+"</OPTION>");
});
}
if(id3=="Intermedios" || id3.substring(0,19)=="SubGrupoIntermedios"){
$(".comboBoxReforzamiento").each(function() {
   $(this).append("<OPTION VALUE="+id1+">"+id2+"</OPTION>");
});
}
   }
       };
function drop(e){


       
var elementoArrastrado = e.dataTransfer.getData("Data"); // Elemento arrastrado
          
       
document.getElementById(elementoArrastrado).setAttribute("name",e.target.id);
//document.getElementById(elementoArrastrado).setAttribute("label",e.target.name);         
//rellenamos los comboBox con tutores dependiendo de el grupo en el que esten
fillComboBox();
e.target.appendChild(document.getElementById(elementoArrastrado));
e.target.style.border = '';  // Quita el borde

          
tamElemX = $('#'+elementoArrastrado).width();
          
tamElemY = $('#'+elementoArrastrado).height();
  
          
posXCont = $('#'+e.target.id).position().left;
          
posYCont = $('#'+e.target.id).position().top;
          
// Posicion absoluta del raton
          
x = e.layerX;
          
y = e.layerY;
          
          
// Si parte del elemento que se quiere mover se queda fuera se cambia las coordenadas para que no sea asi
          
if (posXCont + tamContX <= x + tamElemX){
           
x = posXCont + tamContX - tamElemX - 15;
         

}

          
document.getElementById(elementoArrastrado).style.position = "absolute";
          
document.getElementById(elementoArrastrado).style.left = x + "px";
          
document.getElementById(elementoArrastrado).style.top = y + "px";


};       
function crearSubGrupoAvanzados() {

   $("#Avanzados").append("<div id='SubGrupoAvanzados"+cont+"' class='subGrupo' name='"+cont+"' ondragover='return over(event)' ondrop='return drop(event)' >SubGrupo Avanzados<a id='SubGrupoAvanzados' name='"+cont+"' class='cerrar' onclick='javascript:closeThisDivAvanzados(this)'>[x]</a><SELECT id='comboBoxAvanzados"+cont+"' class='comboBoxAvanzados' NAME='selCombo' style='width: 90%' SIZE=1 onChange='javascript:alert('prueba');'><OPTION VALUE='link pagina 1'>Seleccionar Tutor</OPTION></SELECT></div>");
   cont+=1;
};
function crearSubGrupoIntermedios() {
   $("#Intermedios").append("<div id='SubGrupoIntermedios"+cont+"' class='subGrupo' name='"+cont+"' ondragover='return over(event)' ondrop='return drop(event)' >SubGrupo Intermedios<a id='SubGrupoIntermedios' name='"+cont+"' class='cerrar' onclick='javascript:closeThisDivIntermedios(this)'>[x]</a><SELECT id='comboBoxIntermedios"+cont+"' class='comboBoxIntermedios' NAME='selCombo' style='width: 90%' SIZE=1 onChange='javascript:alert('prueba');'><OPTION VALUE='link pagina 1'>Seleccionar Tutor</OPTION></SELECT></div>");
   cont+=1;
};
function crearSubGrupoReforzamiento() {

   $("#Reforzamiento").append("<div id='SubGrupoReforzamiento"+cont+"' class='subGrupo' name='"+cont+"' ondragover='return over(event)' ondrop='return drop(event)'>SubGrupo Reforzamiento<a id='SubGrupoReforzamiento' name='"+cont+"' class='cerrar' onclick='javascript:closeThisDivReforzamiento(this)'>[x]</a><SELECT id='comboBoxReforzamiento"+cont+"' class='comboBoxReforzamiento' NAME='selCombo' style='width: 90%' SIZE=1 onChange='javascript:alert('prueba');'><OPTION VALUE='link pagina 1'>Seleccionar Tutor</OPTION></SELECT></div>");
   cont+=1;
};
function closeThisDivAvanzados(div) { 
var openDiv = document.getElementsByName(div.name); 
var parentDiv = document.getElementById('Avanzados');
var cuadritos = openDiv[0].getElementsByClassName('cuadradito')
for(var i=0; i<cuadritos.length; i++)
               {
                   $("#Avanzados").append("<div title="+cuadritos[i].innerHTML+" class='cuadradito' name='Avanzados' id="+cuadritos[i].id+" draggable='true' ondragstart='start(event)' ondragend='end(event)'>"+cuadritos[i].innerHTML+"</div>");
               }
parentDiv.removeChild(openDiv[0]);
};
function closeThisDivIntermedios(div) {
var openDiv = document.getElementsByName(div.name); 
var parentDiv = document.getElementById('Intermedios');
var cuadritos = openDiv[0].getElementsByClassName('cuadradito')
for(var i=0; i<cuadritos.length; i++)
               {
                   $("#Intermedios").append("<div title="+cuadritos[i].innerHTML+" class='cuadradito' name='Intermedios' id="+cuadritos[i].id+" draggable='true' ondragstart='start(event)' ondragend='end(event)'>"+cuadritos[i].innerHTML+"</div>");
               }
parentDiv.removeChild(openDiv[0]);
};
function closeThisDivReforzamiento(div) { 
var openDiv = document.getElementsByName(div.name);  
var parentDiv = document.getElementById('Reforzamiento');
var cuadritos = openDiv[0].getElementsByClassName('cuadradito')
for(var i=0; i<cuadritos.length; i++)
               {
                   $("#Reforzamiento").append("<div title="+cuadritos[i].innerHTML+" class='cuadradito' name='Reforzamiento' id="+cuadritos[i].id+" draggable='true' ondragstart='start(event)' ondragend='end(event)'>"+cuadritos[i].innerHTML+"</div>");
               }
parentDiv.removeChild(openDiv[0]);
};

       
       function makeGroups() {
  $.ajax({
   url: "{% url 'groups:getGroups' id_class %}",
   type: "POST",
   data: $("#formJson").serialize(),
   success: function (response) {
   
$('.cuadradito').remove();
      var student = JSON.parse(response);
      for(var i=0;i<student.length;i++){
      
if(student[i]['type']=='Reforzamiento'){
      
$("#Reforzamiento").append("<div title="+student[i]['name']+" class='cuadradito' name='Reforzamiento' id="+student[i]['kaid_student']+" draggable='true' ondragstart='start(event)' ondragend='end(event)'>"+student[i]['name']+"</div>");
      
}
      
if(student[i]['type']=='Intermedios'){
      
$("#Intermedios").append("<div title="+student[i]['name']+" class='cuadradito' name='Intermedios' id="+student[i]['kaid_student']+" draggable='true' ondragstart='start(event)' ondragend='end(event)'>"+student[i]['name']+"</div>");
      
}
      
if(student[i]['type']=='Avanzados'){
      
$("#Avanzados").append("<div title="+student[i]['name']+" class='cuadradito' name='Avanzados' id="+student[i]['kaid_student']+" draggable='true' ondragstart='start(event)' ondragend='end(event)'>"+student[i]['name']+"</div>");
      
} 
      }
      fillComboBox()
      alert('Agrupacion realizada correctamente.');
   }
});
};
function saveGroups(){
  //Funcion que guarda las agrupaciones.
  var divs = document.querySelectorAll('.cuadradito');
  var jsonArr = [];
  var aux = false;
  for (var i = 0; i < divs.length; i++) {    
    var kaid = divs[i].getAttribute('id');
    var group = divs[i].getAttribute('name');
    if(group=='Avanzados' || group=='Intermedios' || group=='Reforzamiento' ||
       group.substring(0,19)=='SubGrupoIntermedios' || group.substring(0,17)=='SubGrupoAvanzados' || group.substring(0,21)=='SubGrupoReforzamiento'){
      aux = true;
    }
    jsonArr.push({
     kaid_student: kaid,
     group: group
    });    
  }
  var tutorsArr = []; 
  tutorsArr.push({  
  kaid_tutor_reforzamiento:$('#comboBoxReforzamiento').val(),
  kaid_tutor_intermedios:$('#comboBoxIntermedios').val(),  
  kaid_tutor_avanzados:$('#comboBoxAvanzados').val()  
  });  

  arrSubGroups = [];
  $('.subGrupo').each(function(indice, elemento) {
    //alert($(elemento).children('select').val());
    arrSubGroups.push({
      name: $(elemento).attr('id'),
      tutor: $(elemento).children('select').val()
    });
    //console.log('El elemento con el índice '+indice+' contiene '+$(elemento).attr('id'))  ;
  });
  $("input[name='subGroups']").val(JSON.stringify(arrSubGroups)); 
  $("input[name='tutors']").val(JSON.stringify(tutorsArr));  
  $("input[name='student_groups']").val(JSON.stringify(jsonArr));  
  if(aux){  
  $.ajax({
     url: "{% url 'groups:getGroups' id_class %}",
     type: "POST",
     data: $("#formJson").serialize(),
     success: function (response) {
        //lo que haces si es exitoso
        alert('Grupos guardados correctamente.');
        location.reload();
     }
  });  
  aux = false;  
  }else{  
  alert('No hay agrupacion para guardar')  
  }
};
</script>
</head>
   <style>
#SinGrupo, #Avanzados, #Intermedios, #Reforzamiento, #skills {
  float: left;
  width: 15.4%;
  height: 400px;
  padding: 10px;
  margin: 10px;
  text-align: center;
  overflow-y: scroll;
  border: 1px solid #D9D9D9;
  border-radius: 5px;
}

#SinGrupo{
  background: #FFFFFF;
}

#Avanzados {
  background: #B6D7A8;
}
#Intermedios {
  background: #FFE599;
}
#Reforzamiento {
  background: #EA9999;
}
.cerrar {
background: #C30202;
color: #000000
}
.cuadradito {
  background: #F5F5F5;
  border: 1px solid #D9D9D9;
  border-radius: 3px;
  width: 140px;
  height: 5px;
  padding: 0 10px 15px;
  margin: 5px;
  cursor: move;
  word-wrap: break-word;
  overflow: hidden;
}
.subGrupo {
   background: #FFFFFF;
   border: 1px solid #000000;
   border-radius: 3px;
   width: 170px;
   height: 140px;
   padding: 0 0px 15px;
   margin: 0px;
   word-wrap: break-word;
   overflow: hidden;
   overflow-y: scroll;
   overflow-y: auto;
   background: rgba(255, 255, 255, 0.2);
}

#topictree{
overflow-y: scroll;
height: 371px;
padding: 10px;
margin: 10px;
}
#topictree_div{
text-align: left;
height: 371px;
padding: 10px;
margin: 10px;
}
#skills{
  text-align: left;
  display: none;

}
#timeline3{
overflow-x: scroll;
float: left;
width: 896px;
height: 40px;
}
#more_contain{
  visibility: hidden;
}
#containerTimeLine{
  display: inline;
  clear:both;
  width: 100%;
}

    </style>
    <style type="text/css">
	    .axis path,
	    .axis line {
	      fill: none;
	      stroke: black;
	      shape-rendering: crispEdges;
	    }

	    .axis text {
	      font-family: sans-serif;
	      font-size: 10px;
	    }

	    .timeline-label {
	      font-family: sans-serif;
	      font-size: 12px;
	    }

	    #timeline2 .axis {
	      transform: translate(0px,40px);
	      -ms-transform: translate(0px,40px); /* IE 9 */
	      -webkit-transform: translate(0px,40px); /* Safari and Chrome */
	      -o-transform: translate(0px,40px); /* Opera */
	      -moz-transform: translate(0px,40px); /* Firefox */
	    }
	    
	    .coloredDiv {
	      height:20px; width:20px; float:left;
	    }
	    .svg{
	    	border = 1px solid black;
	    }
	  </style>
    <section id='content'>
   
       <div id="SinGrupo" name="SinGrupo" ondragover="return over(event)" ondrop="return drop(event)" ><ul>No agrupados</ul></div>
 
        <div id="Avanzados" name="Avanzados" ondragover="return over(event)" ondrop="return drop(event)"><ul>Avanzados</ul>
        <SELECT id="comboBoxAvanzados" class="comboBoxAvanzados" NAME="comboBox" style="width: 90%" SIZE=1> 
<OPTION VALUE="tutores">Seleccionar Tutor</OPTION>
</SELECT>
<button onclick="crearSubGrupoAvanzados(this);" class='nuevo_sub'>nuevo sub-grupo</button>
        </div>
 
       <div id="Intermedios" name="Intermedios" ondragover="return over(event)" ondrop="return drop(event)">Intermedios
       
<SELECT id="comboBoxIntermedios" class="comboBoxIntermedios" NAME="selCombo" style="width: 90%" SIZE=1 onChange=""> 
<OPTION VALUE="link pagina 1">Seleccionar Tutor</OPTION>
</SELECT>
<button onclick="crearSubGrupoIntermedios(this);" class='nuevo_sub'>nuevo sub-grupo</button>
       </div>
       <div id="Reforzamiento" name="Reforzamiento" ondragover="return over(event)" ondrop="return drop(event)">Reforzamiento
       
<SELECT id="comboBoxReforzamiento" class="comboBoxReforzamiento" NAME="selCombo" style="width: 90%" SIZE=1 onChange=""> 
<OPTION VALUE="link pagina 1">Seleccionar Tutor</OPTION>
</SELECT>
<button onclick="crearSubGrupoReforzamiento(this);" class='nuevo_sub'>nuevo sub-grupo</button>
       </div>
<div class="input-wrapper" id="topictree_div" align="center">
<input id="skill_search" class="ui-corner-all placeholder simple-input search-input blur-on-esc" type="text" placeholder="Busca temas y habilidades">
<i class="icon-search"></i>
<div id="topictree" align="left"></div>
</div>
<div id="skills"></div>
    </section>
<div align="left">
  <div id='containerTimeLine'>
    <div id="timeline3" ></div>
    <div id='more_contain'>
      <img src="{% static 'img/mas.png' %}" id='more' alt="Agregar agrupacion" height="20" width="20">
    </div>
  </div>


<form action="" method="post" id='formJson'>{% csrf_token %}
       <input name="skills" type="hidden" value="[]">
       <input name="student_groups" type="hidden" value=''>
       <input name="tutors" type="hidden" value=''>
       <input name="subGroups" type="hidden" value=''>
       <input type='button' onclick='saveGroups()' class="kui-button kui-button-plain kui-button-primary" value='Guardar' id='save'>
       <input type='button' onclick='makeGroups()' class="kui-button kui-button-plain kui-button-primary" value='Realizar Agrupacion' id='make'>
   </form>
       <div id="hoverRes">
      <div class="coloredDiv"></div>
      <div id="name"></div>
      <div id="scrolled_date"></div>
    </div>
</div>


<script type="text/javascript">
$(document).ready(function(){
 
{% if students %}
{% for student in students %}
{% if student.type == 'SinGrupo' %}
$("#SinGrupo").append("<div title='{{ student.name }}'  class='cuadradito' name='SinGrupo' id='{{ student.kaid_student }}' draggable='true' ondragstart='start(event)' ondragend='end(event)'>{{ student.name }}</div>");
{% endif%}
{% if student.type == 'Reforzamiento' %}
$("#Reforzamiento").append("<div title='{{ student.name }}' class='cuadradito' name='Reforzamiento' id='{{ student.kaid_student }}' draggable='true' ondragstart='start(event)' ondragend='end(event)'>{{ student.name }}</div>");
{% endif%}
{% if student.type == 'Intermedios' %}
$("#Intermedios").append("<div title='{{ student.name }}' class='cuadradito' name='Intermedios' id='{{ student.kaid_student }}' draggable='true' ondragstart='start(event)' ondragend='end(event)'>{{ student.name }}</div>");
{% endif%}
{% if student.type == 'Avanzados' %}
$("#Avanzados").append("<div title='{{ student.name }}' class='cuadradito' name='Avanzados' id='{{ student.kaid_student }}' draggable='true' ondragstart='start(event)' ondragend='end(event)'>{{ student.name }}</div>");
{% endif%}
{% endfor %}
{% endif %}
});
</script>
<script>
var topictree = JSON.parse('{{ topictree | escapejs }}');
$('#topictree').on('changed.jstree', function (e, data) {
   selected_skills=$('#topictree')
   
.jstree()
   
.get_bottom_selected(true);
   selected_skills_id=new Array();
   //Get selected skills (leaves of the topictree json)
   for (i=0;i< selected_skills.length;i++){
   
if (selected_skills[i].data){
   
selected_skills_id.push(selected_skills[i].data["skill_id"]);
   
}
   }
   //Remove duplicate skill id's in case they have been associated to more than one selected subskill
   selected_skills_id = selected_skills_id.filter(
   
function( item, index, inputArray ) {
return inputArray.indexOf(item) == index;
});
$('input[name="skills"]').val(JSON.stringify(selected_skills_id));
   }).jstree(topictree);
   var to=false;
   $('#skill_search').keyup(function () {
   if(to) { clearTimeout(to); }
   to = setTimeout(function () {
     var v = $('#skill_search').val();
     $('#topictree').jstree(true).search(v);
   }, 250);
  });
  var to=false;
   $('#skill_search').keyup(function () {
   if(to) { clearTimeout(to); }
   to = setTimeout(function () {
     var v = $('#skill_search').val();
     $('#topictree').jstree(true).search(v);
   }, 250);
  });;
</script>
<script type="text/javascript">
window.onload = function() {
	
		var testData = [
		     ];

		var master_groups = JSON.parse('{{ groups | escapejs }}');
		for (i=0;i<master_groups.length;i++){
			times ={};
			var arr=[];
			dic = {};
			dic.starting_time = master_groups[i]['fields']['date_int'];
			dic.ending_time = master_groups[i]['fields']['date_int']+20;
			arr.push(dic);
			times.times = arr;
			times.label = master_groups[i]['fields']['date'];
			times.id = master_groups[i]['pk'];
			testData.push(times);
		};
		var width = testData.length*100;

  function timelineHover() {
    //funcion que controla la linea de tiempo. y la visualizacion de las agrupaciones.
    var chart = d3.timeline()
      .width(width*1)
      .margin({left:30, right:80, top:0, bottom:0})
      .hover(function (d, i, datum) {
      // d is the current rendering object
      // i is the index during d3 rendering
      // datum is the id object
        var div = $('#hoverRes');
        var colors = chart.colors();
        div.find('.coloredDiv').css('background-color', colors(i))
        div.find('#name').text(datum.label);
      })
      .click(function (d, i, datum) {
      	//Funcion que carga todos los datos del grupo datum.id
      	var groups
        var students
        var skills
      	$.ajax({ // solicita los grupos creados en la agrupacion seleccionada
			   url: "{% url 'groups:getMakedGroup' id_class %}",
			   type: "POST",
         async: false,
			   data: {id_master_group : datum.id},
			   success: function (response) {
					groups = JSON.parse(response);
          //Eliminar las agrupaciones anteriores mostradas en pantalla.
          $('.cuadradito').appendTo('#SinGrupo');
          $('select').remove();
          $('#Avanzados').empty();
          $('#Intermedios').empty();
          $('#Reforzamiento').empty();
					for(var i=0;i<groups.length;i++){
            //en este for se crean todos los div segun la agrupacion seleccionada.
            //alert(groups[i]['fields']['type'])
            //Agrega cada subgrupo en el div que le corresponde.
            type = "#"+groups[i]['fields']['type'];//type grupo
            //alert(groups[i]['fields']['kaid_student_tutor']);
            tutor = "#"+groups[i]['fields']['kaid_student_tutor'];
            //alert($(tutor).attr('title'));
            if (type == '#Avanzados'){
              $("#Avanzados").append("<div class='"+(groups[i]['pk']).toString()+"' style='border:1px solid #D9D9D9'>"+
                $(tutor).attr('title')+"</div>");
            }
            if (type == '#Intermedios'){
              $("#Intermedios").append("<div class='"+(groups[i]['pk']).toString()+"' style='border:1px solid #D9D9D9'>"
                +$(tutor).attr('title')+"</div>");
            }
            if (type == '#Reforzamiento'){
              $("#Reforzamiento").append("<div class='"+(groups[i]['pk']).toString()+"' style='border:1px solid #D9D9D9'>"
                +$(tutor).attr('title')+"</div>");
            }
            if (type.substring(1,22) == 'SubGrupoReforzamiento'){
              $("#Reforzamiento").append("<div class='"+(groups[i]['pk']).toString()+"' id='"
                +groups[i]['fields']['type']+"' style='border:1px solid #D9D9D9'>"+$(tutor).attr('title')+"</div>");
            }
            if (type.substring(1,20) == 'SubGrupoIntermedios'){
              $("#Intermedios").append("<div class='"+(groups[i]['pk']).toString()+"' id='"
                +groups[i]['fields']['type']+"' style='border:1px solid #D9D9D9'>"+$(tutor).attr('title')+"</div>");
            }
            if (type.substring(1,18) == 'SubGrupoAvanzados'){
              $("#Avanzados").append("<div class='"+(groups[i]['pk']).toString()+"' id='"
                +groups[i]['fields']['type']+"' style='border:1px solid #D9D9D9'>"+$(tutor).attr('title')+"</div>");
            }
					}
			   }
		    });
        $.ajax({ // solicita los estudiantes de cada grupo
         url: "{% url 'groups:getStudentGroup' id_class %}",
         type: "POST",
         async: false,
         data: {id_master_group : datum.id},
         success: function (response) {
            students = JSON.parse(response);
            for(var i=0;i<students.length;i++){
              var g = "." + (students[i]['fields']['id_group']).toString();
              var s = "#" + (students[i]['fields']['kaid_student']).toString();
              $(s).appendTo(g);//agrega cada estudiante a su correspondiente agrupacion.
          }
         }
        });
        $('#topictree_div').remove();
        $('#save').remove();
        $('#make').remove();
        $.ajax({ // solicita las habilidades de cada grupo
         url: "{% url 'groups:getSkillGroup' id_class %}",
         type: "POST",
         async: false,
         data: {id_master_group : datum.id},
         success: function (response) {
            skills = JSON.parse(response);
            $('#skills').empty();
            $('#skills').css('display','inline');
            for(var i=0;i<skills.length;i++){
              //alert(skills[i]['fields']['name_spanish'])
              $('#skills').append("<li>"+skills[i]['fields']['name_spanish']+"</li>");
              //var g = "." + (students[i]['fields']['id_group']).toString();
              //var s = "#" + (students[i]['fields']['kaid_student']).toString();
              //$(s).appendTo(g);
          }
         }
        });
        $(".cuadradito").removeAttr("draggable");
        $('.nuevo_sub').remove()
        //alert(datum.id);
        //<img src="smiley.gif" alt="Smiley face" height="42" width="42">
        $('#more_contain').css('visibility', 'visible');
        $('#more_contain').on("click","a,img", function (e) {
            e.preventDefault();
            location.reload();
        });
      })
      .scroll(function (x, scale) {
        //$("#scrolled_date").text(scale.invert(x) + " to " + scale.invert(x+width));
      })
      .display("circle")
      .itemMargin(0);
    var svg = d3.select("#timeline3").append("svg").attr("width", width)
      .datum(testData).call(chart);
  }
  timelineHover();
  $("#timeline3").scrollLeft(width);//lleva el scrollbar al final
}
</script>
{% endblock %}
